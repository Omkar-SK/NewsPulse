<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsPulse - Trending Headlines Analyzer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="i18n-translations.js"></script>

    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #7c3aed;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* ========== GRADIENT BACKGROUND - ONLY CHANGE ========== */
        /* ========== BACKGROUND - GRADIENT ONLY IN DARK MODE ========== */
body {
    background-color: var(--light);
    color: var(--dark);
    transition: all 0.3s ease;
    min-height: 100vh;
}

body.dark-mode {
    background: linear-gradient(135deg, #01121F 0%, #1C1505 100%);
    background-attachment: fixed;
    color: #E0E8F0; /* Light grayish-blue text for dark mode */
}
/* ========== DARK MODE TEXT COLOR ADJUSTMENTS ========== */

/* Main headings and titles in dark mode */
body.dark-mode h1,
body.dark-mode h2,
body.dark-mode h3,
body.dark-mode h4,
body.dark-mode h5,
body.dark-mode h6 {
    color: #A5B4C5; /* Soft blue-gray for headings */
}

body.dark-mode .section-header h2 {
    color: #C5D3E0; /* Lighter for section headers */
}

/* News card text */
body.dark-mode .news-content h3,
body.dark-mode .daily-mix-card-content h3 {
    color: #C5D3E0; /* Light blue-gray for card titles */
}

body.dark-mode .news-content p,
body.dark-mode .daily-mix-card-content p {
    color: #8B9DAF; /* Medium blue-gray for descriptions */
}

/* Meta information */
body.dark-mode .news-meta,
body.dark-mode .daily-mix-meta {
    color: #7A8C9E; /* Softer gray-blue for meta text */
}

/* Navbar links */
body.dark-mode .nav-link {
    color: #A5B4C5;
}

body.dark-mode .nav-link:hover,
body.dark-mode .nav-link.active {
    color: #00D9FF; /* Cyan accent on hover */
    text-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

/* Sidebar text */
body.dark-mode .sidebar-widget h3 {
    color: #8B9DAF;
}

body.dark-mode .bookmark-item h4 {
    color: #C5D3E0;
}

body.dark-mode .bookmark-item span {
    color: #7A8C9E;
}

/* Footer text */
body.dark-mode .footer-col h4 {
    color: #C5D3E0;
}

body.dark-mode .footer-col p,
body.dark-mode .footer-col a {
    color: #8B9DAF;
}

body.dark-mode .footer-col a:hover {
    color: #00D9FF;
}

body.dark-mode .footer-bottom {
    color: #7A8C9E;
}

/* Analysis cards */
body.dark-mode .analysis-card h3,
body.dark-mode .stat-card h3 {
    color: #A5B4C5;
}

body.dark-mode .stat-card .value {
    color: #00D9FF; /* Cyan for stat values */
    text-shadow: 0 0 10px rgba(0, 217, 255, 0.2);
}

/* Category buttons */
body.dark-mode .category-btn {
    color: #A5B4C5;
    background-color: rgba(15, 25, 40, 0.7);
    border-color: rgba(165, 180, 197, 0.2);
}

body.dark-mode .category-btn.active,
body.dark-mode .category-btn:hover {
    color: #01121F;
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    border-color: #00D9FF;
}

/* Trending topics */
body.dark-mode .trending-topics a {
    color: #A5B4C5;
    background-color: rgba(15, 25, 40, 0.6);
    border: 1px solid rgba(165, 180, 197, 0.2);
}

body.dark-mode .trending-topics a:hover {
    color: #00D9FF;
    background-color: rgba(0, 217, 255, 0.1);
    border-color: #00D9FF;
}

/* Word cloud */
body.dark-mode .word {
    color: #A5B4C5;
    background-color: rgba(15, 25, 40, 0.6);
    border: 1px solid rgba(165, 180, 197, 0.2);
}

body.dark-mode .word:hover {
    color: #00D9FF;
    background-color: rgba(0, 217, 255, 0.15);
    border-color: #00D9FF;
}

/* Search bar */
body.dark-mode .search-bar input {
    color: #C5D3E0;
    background-color: rgba(15, 25, 40, 0.7);
    border-color: rgba(165, 180, 197, 0.2);
}

body.dark-mode .search-bar input::placeholder {
    color: #7A8C9E;
}

body.dark-mode .search-bar input:focus {
    border-color: #00D9FF;
    box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

body.dark-mode .search-bar i {
    color: #00D9FF;
}

/* Filters */
body.dark-mode .filters label {
    color: #8B9DAF;
}

body.dark-mode .filters select {
    color: #C5D3E0;
    background-color: rgba(15, 25, 40, 0.7);
    border-color: rgba(165, 180, 197, 0.2);
}

body.dark-mode .filters select:focus {
    border-color: #00D9FF;
    box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

/* Mode switch text */
body.dark-mode .mode-switch span {
    color: #A5B4C5;
}

/* Empty states */
body.dark-mode .empty-state {
    color: #8B9DAF;
}

body.dark-mode .daily-mix-empty h3 {
    color: #C5D3E0;
}

body.dark-mode .daily-mix-empty p {
    color: #8B9DAF;
}

/* Carousel content */
body.dark-mode .carousel-content h3 {
    color: #FFFFFF;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

body.dark-mode .carousel-content p {
    color: #E0E8F0;
}

/* Cache indicators */
body.dark-mode .cache-indicator {
    background-color: rgba(0, 217, 255, 0.2);
    color: #00D9FF;
    border: 1px solid rgba(0, 217, 255, 0.4);
}

/* Daily Mix title */
body.dark-mode .daily-mix-title h2 {
    color: #C5D3E0;
}

body.dark-mode .daily-mix-subtitle {
    color: #8B9DAF;
}

/* Sentiment badges */
body.dark-mode .sentiment-badge {
    background-color: rgba(15, 25, 40, 0.9);
}

body.dark-mode .sentiment-positive {
    color: #00FF99;
    border-color: rgba(0, 255, 153, 0.5);
}

body.dark-mode .sentiment-negative {
    color: #FF6B6B;
    border-color: rgba(255, 107, 107, 0.5);
}

body.dark-mode .sentiment-neutral {
    color: #A5B4C5;
    border-color: rgba(165, 180, 197, 0.5);
}

/* Buttons - maintain primary color but adjust for dark background */
body.dark-mode .btn-primary {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
    font-weight: 600;
}

body.dark-mode .btn-primary:hover {
    background: linear-gradient(135deg, #00E6FF, #00B3E6);
    box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
}

/* Daily Mix recommended badge */
body.dark-mode .daily-mix-recommended-badge {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
}

/* Reaction buttons text */
body.dark-mode .reaction-btn {
    color: #A5B4C5;
}

body.dark-mode .reaction-btn:hover {
    background-color: rgba(0, 217, 255, 0.1);
}

body.dark-mode .reaction-btn.active {
    color: #FFFFFF;
}

/* Similar articles modal */
body.dark-mode .modal-content {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.95), rgba(28, 21, 5, 0.95));
}

body.dark-mode .similar-article h4 {
    color: #C5D3E0;
}

body.dark-mode .similar-article p {
    color: #8B9DAF;
}

/* Auth modal in dark mode */
body.dark-mode .auth-modal {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.98), rgba(28, 21, 5, 0.98));
    border: 1px solid rgba(0, 217, 255, 0.2);
}

body.dark-mode .auth-header h2 {
    color: #00D9FF;
    text-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

body.dark-mode .auth-header p {
    color: #8B9DAF;
}

body.dark-mode .form-group label {
    color: #A5B4C5;
}

body.dark-mode .form-group input {
    background-color: rgba(15, 25, 40, 0.7);
    border-color: rgba(165, 180, 197, 0.3);
    color: #C5D3E0;
}

body.dark-mode .form-group input::placeholder {
    color: #7A8C9E;
}

body.dark-mode .form-group input:focus {
    border-color: #00D9FF;
    box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2);
}

body.dark-mode .auth-switch {
    color: #8B9DAF;
}

body.dark-mode .auth-switch a {
    color: #00D9FF;
}

body.dark-mode .auth-modal-close {
    color: #A5B4C5;
}

body.dark-mode .auth-modal-close:hover {
    color: #00D9FF;
}

/* User dropdown */
body.dark-mode .user-dropdown {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.95), rgba(28, 21, 5, 0.95));
    border: 1px solid rgba(0, 217, 255, 0.2);
}

body.dark-mode .user-dropdown-item {
    color: #C5D3E0;
}

body.dark-mode .user-dropdown-item:hover {
    background-color: rgba(0, 217, 255, 0.1);
    color: #00D9FF;
}

/* User avatar */
body.dark-mode .user-avatar {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
}

/* Spinner in dark mode */
body.dark-mode .spinner {
    border-color: rgba(165, 180, 197, 0.2);
    border-top-color: #00D9FF;
}

/* ========== END DARK MODE TEXT COLOR ADJUSTMENTS ========== */
/* ========== END BACKGROUND ========== */
        /* ========== END GRADIENT BACKGROUND ========== */

        html, body {
            overflow-x: hidden;
            max-width: 100vw;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            overflow-x: hidden;
        }

        /* Auth Modal Styles */
        .auth-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .auth-overlay.active {
            display: flex;
        }

        .auth-modal {
            background-color: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .dark-mode .auth-modal {
            background-color: #334155;
        }

        .auth-modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
            background: none;
            border: none;
        }

        .auth-modal-close:hover {
            color: var(--primary);
        }

        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .auth-header h2 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .auth-header p {
            color: var(--gray);
            font-size: 14px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            font-size: 14px;
            color: var(--gray);
        }

        .form-group input {
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--gray-light);
            font-size: 14px;
            transition: all 0.3s;
        }

        .dark-mode .form-group input {
            background-color: #475569;
            border-color: #64748b;
            color: var(--light);
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .error-message {
            color: var(--danger);
            font-size: 13px;
            display: none;
        }

        .error-message.active {
            display: block;
        }

        .btn-auth {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-auth-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-auth-primary:hover {
            background-color: var(--primary-light);
        }

        .btn-auth-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: var(--gray);
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        /* Header Styles */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--gray-light);
        }

        .dark-mode .navbar {
            border-bottom-color: #334155;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .logo {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary);
    text-decoration: none;
    transition: all 0.3s;
}

/* Dark mode gradient logo with animation */
body.dark-mode .logo {
    background: linear-gradient(135deg, #00D9FF 0%, #00FFB3 50%, #00D9FF 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    background-size: 200% auto;
    animation: logoShine 3s linear infinite;
    filter: drop-shadow(0 0 8px rgba(0, 217, 255, 0.4));
    font-weight: 800;
    letter-spacing: 1px;
}

@keyframes logoShine {
    0% { background-position: 0% center; }
    100% { background-position: 200% center; }
}

body.dark-mode .logo:hover {
    filter: drop-shadow(0 0 15px rgba(0, 217, 255, 0.7));
    transform: scale(1.05);
}

        .nav-links {
            display: flex;
            gap: 30px;
        }

        .nav-link {
            text-decoration: none;
            color: var(--gray);
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-link.active, .nav-link:hover {
            color: var(--primary);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .user-avatar:hover {
            background-color: var(--primary-light);
        }

        .user-dropdown {
    display: none;
    position: absolute;
    top: 50px;
    right: 0;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    min-width: 200px;
    padding: 10px 0;
    z-index: 9999; /* CHANGED from 1000 */
}

        .dark-mode .user-dropdown {
            background-color: #334155;
        }

        .user-dropdown.active {
            display: block;
        }

        .user-dropdown-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--dark);
        }

        .dark-mode .user-dropdown-item {
            color: var(--light);
        }

        .user-dropdown-item:hover {
            background-color: var(--gray-light);
        }

        .dark-mode .user-dropdown-item:hover {
            background-color: #475569;
        }

        .mode-switch {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-light);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .search-bar {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-bar i {
            position: absolute;
            left: 12px;
            color: var(--gray);
        }

        .search-bar input {
            padding: 10px 10px 10px 40px;
            border-radius: 8px;
            border: 1px solid var(--gray-light);
            background-color: white;
            width: 250px;
            font-size: 14px;
        }

        .dark-mode .search-bar input {
            background-color: #334155;
            border-color: #475569;
            color: var(--light);
        }

        .nav-icon {
            color: var(--gray);
            cursor: pointer;
            transition: color 0.3s;
        }

        .nav-icon:hover {
            color: var(--primary);
        }

        .btn-login {
            padding: 8px 20px;
            border-radius: 8px;
            background-color: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-login:hover {
            background-color: var(--primary-light);
        }

        /* Page Content */
        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        /* Loading Spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid var(--gray-light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Cache Indicator */
        .cache-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .cache-indicator.cached {
            background-color: var(--success);
            color: white;
        }

        .cache-indicator.fresh {
            background-color: var(--warning);
            color: white;
        }

        /* Main Content */
        .main-content {
            display: flex;
            gap: 30px;
            margin: 30px 0;
            overflow-x: hidden;
        }

        .feed {
            flex: 1;
            overflow-x: hidden;
        }

        /* Trending News Carousel */
        .trending-news {
            margin-bottom: 40px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            font-size: 24px;
            font-weight: 700;
        }

        .carousel-container {
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    touch-action: pan-y;
    z-index: 1; /* ADD this */
}

        .carousel {
            display: flex;
            transition: transform 0.5s ease;
        }

        .carousel-item {
            min-width: 100%;
            position: relative;
        }

        .carousel-item img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            display: block;
        }

        .carousel-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.8));
            color: white;
            padding: 30px;
        }

        .carousel-content h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .carousel-content p {
            margin-bottom: 15px;
            opacity: 0.9;
        }

        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.8);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
        }

        .carousel-nav:hover {
            background: white;
        }

        .carousel-prev {
            left: 20px;
        }

        .carousel-next {
            right: 20px;
        }

        .carousel-indicators {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--gray-light);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .indicator.active {
            background-color: var(--primary);
        }

        /* ========== YOUR DAILY MIX SECTION ========== */
        .daily-mix-section {
            margin-bottom: 30px;
            position: relative;
        }

        .daily-mix-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .daily-mix-title h2 {
            font-size: 24px;
            font-weight: 700;
        }

        .daily-mix-subtitle {
            color: var(--gray);
            font-size: 14px;
            margin-top: 3px;
        }

        .daily-mix-carousel-wrapper {
            position: relative;
            width: 100%;
            padding: 0 50px;
        }

        .daily-mix-carousel-container {
            position: relative;
            width: 100%;
            overflow: hidden;
        }

        .daily-mix-carousel {
            display: flex;
            gap: 20px;
            overflow-x: scroll;
            overflow-y: hidden;
            scroll-behavior: smooth;
            padding: 10px 0 20px 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
            max-width: 100%;
        }

        .daily-mix-carousel::-webkit-scrollbar {
            display: none;
        }

        /* Match news card size exactly */
        .daily-mix-card {
            min-width: 300px;
            max-width: 300px;
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
        }

        .dark-mode .daily-mix-card {
            background-color: #334155;
        }

        .daily-mix-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .daily-mix-card-image {
            position: relative;
            height: 180px;
            overflow: hidden;
        }

        .daily-mix-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .daily-mix-card:hover .daily-mix-card-image img {
            transform: scale(1.05);
        }

        .daily-mix-recommended-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .daily-mix-card-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .daily-mix-card-content h3 {
            font-size: 18px;
            margin-bottom: 10px;
            line-height: 1.4;
            height: 60px;
            overflow: hidden;
            word-wrap: break-word;
        }

        .daily-mix-card-content p {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
            height: 63px;
            overflow: hidden;
            word-wrap: break-word;
            flex-grow: 1;
        }

        .daily-mix-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 15px;
        }

        .daily-mix-category {
            background-color: var(--primary-light);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 11px;
        }

        .daily-mix-scroll-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid var(--gray-light);
        }

        .dark-mode .daily-mix-scroll-btn {
            background-color: #334155;
            border-color: #475569;
        }

        .daily-mix-scroll-btn:hover {
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
            transform: translateY(-50%) scale(1.05);
        }

        .daily-mix-scroll-btn i {
            color: var(--primary);
            font-size: 20px;
        }

        .daily-mix-scroll-left {
            left: 0;
        }

        .daily-mix-scroll-right {
            right: 0;
        }

        .daily-mix-scroll-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        .daily-mix-empty {
            text-align: center;
            padding: 60px 20px;
            background-color: var(--gray-light);
            border-radius: 12px;
        }

        .dark-mode .daily-mix-empty {
            background-color: #475569;
        }

        .daily-mix-empty i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--gray);
        }

        .daily-mix-empty h3 {
            font-size: 20px;
            margin-bottom: 8px;
        }

        .daily-mix-empty p {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 15px;
        }

        .daily-mix-empty .btn {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .daily-mix-empty .btn:hover {
            background-color: var(--primary-light);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .daily-mix-card {
                min-width: 280px;
                max-width: 280px;
            }

            .daily-mix-carousel-wrapper {
                padding: 0 45px;
            }
        }

        @media (max-width: 768px) {
            .daily-mix-title h2 {
                font-size: 20px;
            }

            .daily-mix-card {
                min-width: 260px;
                max-width: 260px;
            }

            .daily-mix-carousel-wrapper {
                padding: 0 40px;
            }

            .daily-mix-scroll-btn {
                width: 40px;
                height: 40px;
            }

            .daily-mix-scroll-btn i {
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .daily-mix-carousel-wrapper {
                padding: 0 35px;
            }

            .daily-mix-scroll-btn {
                width: 35px;
                height: 35px;
            }
        }
        /* ========== END DAILY MIX SECTION ========== */

        /* Category Filters */
        .category-section {
            margin-bottom: 30px;
        }

        .category-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid var(--gray-light);
            background-color: white;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .dark-mode .category-btn {
            background-color: #334155;
            border-color: #475569;
        }

        .category-btn.active, .category-btn:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* News Grid */
        .news-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .news-card {
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .dark-mode .news-card {
            background-color: #334155;
        }

        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .news-image {
            position: relative;
            height: 180px;
            overflow: hidden;
        }

        .news-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .news-card:hover .news-image img {
            transform: scale(1.05);
        }

        .bookmark-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .bookmark-btn:hover {
            background-color: white;
            transform: scale(1.1);
        }

        .bookmark-btn.bookmarked {
            color: var(--primary);
        }

        .sentiment-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            background-color: rgba(255, 255, 255, 0.9);
        }

        .sentiment-positive {
            color: var(--success);
            border: 1px solid var(--success);
        }

        .sentiment-negative {
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .sentiment-neutral {
            color: var(--gray);
            border: 1px solid var(--gray);
        }

        .news-content {
            padding: 20px;
            display: flex;
            flex-direction: column;
            flex-grow: 1;
        }

        .news-content h3 {
            font-size: 18px;
            margin-bottom: 10px;
            line-height: 1.4;
            height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .news-content p {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
            flex-grow: 1;
            height: 63px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 15px;
        }

        .news-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-light);
            margin-top: auto;
        }

        .dark-mode .news-actions {
            border-top-color: #475569;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-light);
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--gray-light);
            color: var(--gray);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-similar {
            background-color: var(--secondary);
            color: white;
            font-size: 12px;
            padding: 6px 12px;
        }

        .btn-similar:hover {
            opacity: 0.9;
        }

        .reactions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .reaction-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 6px;
            user-select: none;
        }

        .reaction-btn:hover {
            transform: scale(1.1);
            background-color: var(--gray-light);
        }

        .dark-mode .reaction-btn:hover {
            background-color: #475569;
        }

        .reaction-btn.active {
            background-color: var(--primary-light);
            color: white;
        }

        .reaction-btn.like.active {
            background-color: var(--success);
            color: white;
        }

        .reaction-btn.dislike.active {
            background-color: var(--danger);
            color: white;
        }

        .reaction-count {
            font-size: 12px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .bookmark-item {
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.3s;
        }

        .bookmark-item:hover {
            background-color: var(--gray-light);
        }

        .dark-mode .bookmark-item:hover {
            background-color: #475569;
        }

        .bookmark-item h4 {
            font-size: 14px;
            margin-bottom: 5px;
        }

        .bookmark-item span {
            font-size: 12px;
            color: var(--gray);
        }

        /* Similar Articles Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .dark-mode .modal-content {
            background-color: #334155;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-close:hover {
            color: var(--primary);
        }

        .similar-article {
            padding: 15px;
            border-bottom: 1px solid var(--gray-light);
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .dark-mode .similar-article {
            border-bottom-color: #475569;
        }

        .similar-article:hover {
            background-color: var(--gray-light);
        }

        .dark-mode .similar-article:hover {
            background-color: #475569;
        }

        .similar-article:last-child {
            border-bottom: none;
        }

        .similarity-score {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            background-color: var(--primary-light);
            color: white;
            font-size: 12px;
            margin-left: 10px;
        }

        /* Analysis Section */
        .analysis-section {
            margin: 40px 0;
        }

        .analysis-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .analysis-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .analysis-card {
            background-color: #334155;
        }

        .analysis-card h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }

        .word-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }

        .word {
            padding: 5px 10px;
            border-radius: 20px;
            background-color: var(--gray-light);
            transition: all 0.3s;
            cursor: pointer;
        }

        .dark-mode .word {
            background-color: #475569;
        }

        .word:hover {
            background-color: var(--primary-light);
            color: white;
            transform: scale(1.05);
        }

        .word-large {
            font-size: 22px;
            font-weight: 700;
        }

        .word-medium {
            font-size: 18px;
            font-weight: 600;
        }

        .word-small {
            font-size: 14px;
        }

        .chart-container {
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chart-container canvas {
            max-width: 200px;
            max-height: 200px;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
        }

        .sidebar-widget {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .sidebar-widget {
            background-color: #334155;
        }

        .sidebar-widget h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .trending-topics {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .trending-topics a {
            display: inline-block;
            padding: 6px 12px;
            background-color: var(--gray-light);
            border-radius: 20px;
            font-size: 12px;
            color: var(--dark);
            text-decoration: none;
            transition: all 0.3s;
        }

        .dark-mode .trending-topics a {
            background-color: #475569;
            color: var(--light);
        }

        .trending-topics a:hover {
            background-color: var(--primary);
            color: white;
        }

        .filters label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--gray);
        }

        .filters select {
            width: 100%;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid var(--gray-light);
            margin-bottom: 15px;
            background-color: white;
            font-size: 14px;
        }

        .dark-mode .filters select {
            background-color: #475569;
            border-color: #64748b;
            color: var(--light);
        }

        .bookmarked-articles {
            min-height: 100px;
        }

        .empty-state {
            color: var(--gray);
            font-style: italic;
            text-align: center;
            padding: 20px 0;
        }

        /* Footer */
        .footer {
            margin-top: 50px;
            padding: 30px 0;
            border-top: 1px solid var(--gray-light);
        }

        .dark-mode .footer {
            border-top-color: #334155;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 20px;
        }

        .footer-col h4 {
            margin-bottom: 15px;
            font-size: 18px;
        }

        .footer-col p, .footer-col a {
            color: var(--gray);
            line-height: 1.6;
        }

        .footer-col a {
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-col a:hover {
            color: var(--primary);
        }

        .social-links {
            display: flex;
            gap: 15px;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--gray-light);
            color: var(--dark);
            transition: all 0.3s;
        }

        .dark-mode .social-links a {
            background-color: #475569;
            color: var(--light);
        }

        .social-links a:hover {
            background-color: var(--primary);
            color: white;
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--gray-light);
            color: var(--gray);
            font-size: 14px;
        }

        .dark-mode .footer-bottom {
            border-top-color: #334155;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .dark-mode .stat-card {
            background-color: #334155;
        }

        .stat-card h3 {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .analysis-container {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                grid-template-columns: 1fr 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 0;
    border-bottom: 1px solid var(--gray-light);
    position: sticky; /* ADD this */
    top: 0; /* ADD this */
    z-index: 9000; /* ADD this */
    background-color: var(--light); /* ADD this for light mode */
}
            
            .nav-left, .nav-right {
                width: 100%;
                justify-content: center;
            }
            
            .search-bar input {
                width: 200px;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
            
            .news-container {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .auth-modal {
                padding: 30px 20px;
            }
        }
    /* ========== DARK MODE TEXT & CARD STYLING ========== */

/* Main headings */
body.dark-mode h1,
body.dark-mode h2,
body.dark-mode h3,
body.dark-mode h4,
body.dark-mode h5,
body.dark-mode h6 {
    color: #A5B4C5;
}

body.dark-mode .section-header h2 {
    color: #C5D3E0;
}

/* News card text */
body.dark-mode .news-content h3,
body.dark-mode .daily-mix-card-content h3 {
    color: #C5D3E0;
}

body.dark-mode .news-content p,
body.dark-mode .daily-mix-card-content p {
    color: #8B9DAF;
}

body.dark-mode .news-meta,
body.dark-mode .daily-mix-meta {
    color: #7A8C9E;
}

/* Navbar links */
body.dark-mode .nav-link {
    color: #A5B4C5;
}

body.dark-mode .nav-link:hover,
body.dark-mode .nav-link.active {
    color: #00D9FF;
    text-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

/* Sidebar text */
body.dark-mode .sidebar-widget h3 {
    color: #8B9DAF;
}

body.dark-mode .bookmark-item h4 {
    color: #C5D3E0;
}

body.dark-mode .bookmark-item span {
    color: #7A8C9E;
}

/* Footer */
body.dark-mode .footer-col h4 {
    color: #C5D3E0;
}

body.dark-mode .footer-col p,
body.dark-mode .footer-col a {
    color: #8B9DAF;
}

body.dark-mode .footer-col a:hover {
    color: #00D9FF;
}

body.dark-mode .footer-bottom {
    color: #7A8C9E;
}

/* Stats */
body.dark-mode .analysis-card h3,
body.dark-mode .stat-card h3 {
    color: #A5B4C5;
}

body.dark-mode .stat-card .value {
    color: #00D9FF;
    text-shadow: 0 0 10px rgba(0, 217, 255, 0.2);
}

/* Daily Mix */
body.dark-mode .daily-mix-title h2 {
    color: #C5D3E0;
}

body.dark-mode .daily-mix-subtitle {
    color: #8B9DAF;
}

body.dark-mode .daily-mix-empty h3 {
    color: #C5D3E0;
}

body.dark-mode .daily-mix-empty p {
    color: #8B9DAF;
}

/* Buttons */
body.dark-mode .category-btn {
    color: #A5B4C5;
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.7), rgba(28, 21, 5, 0.7));
    backdrop-filter: blur(5px);
    border: 1px solid rgba(0, 217, 255, 0.2);
}

body.dark-mode .category-btn:hover {
    background: linear-gradient(145deg, rgba(0, 217, 255, 0.15), rgba(0, 153, 204, 0.15));
    border-color: #00D9FF;
    box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
}

body.dark-mode .category-btn.active {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
    border-color: #00D9FF;
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
}

/* Trending topics */
body.dark-mode .trending-topics a {
    color: #A5B4C5;
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.6), rgba(28, 21, 5, 0.6));
    backdrop-filter: blur(5px);
    border: 1px solid rgba(0, 217, 255, 0.15);
}

body.dark-mode .trending-topics a:hover {
    background: rgba(0, 217, 255, 0.12);
    border-color: #00D9FF;
    color: #00D9FF;
    box-shadow: 0 0 12px rgba(0, 217, 255, 0.3);
}

/* Word cloud */
body.dark-mode .word {
    color: #A5B4C5;
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.6), rgba(28, 21, 5, 0.6));
    backdrop-filter: blur(5px);
    border: 1px solid rgba(0, 217, 255, 0.15);
}

body.dark-mode .word:hover {
    background: rgba(0, 217, 255, 0.15);
    border-color: #00D9FF;
    color: #00D9FF;
    box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
}

/* Search & Filters */
body.dark-mode .search-bar input,
body.dark-mode .filters select {
    color: #C5D3E0;
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.7), rgba(28, 21, 5, 0.7));
    backdrop-filter: blur(5px);
    border: 1px solid rgba(0, 217, 255, 0.2);
}

body.dark-mode .search-bar input::placeholder {
    color: #7A8C9E;
}

body.dark-mode .search-bar input:focus,
body.dark-mode .filters select:focus {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    border-color: #00D9FF;
    box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2), 0 0 15px rgba(0, 217, 255, 0.3);
}

body.dark-mode .search-bar i {
    color: #00D9FF;
}

body.dark-mode .filters label {
    color: #8B9DAF;
}

/* Mode switch */
body.dark-mode .mode-switch span {
    color: #A5B4C5;
}

/* Empty states */
body.dark-mode .empty-state {
    color: #8B9DAF;
}

/* Carousel */
body.dark-mode .carousel-content h3 {
    color: #FFFFFF;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

body.dark-mode .carousel-content p {
    color: #E0E8F0;
}

/* Sentiment badges */
body.dark-mode .sentiment-badge {
    background-color: rgba(15, 25, 40, 0.9);
}

body.dark-mode .sentiment-positive {
    color: #00FF99;
    border-color: rgba(0, 255, 153, 0.5);
}

body.dark-mode .sentiment-negative {
    color: #FF6B6B;
    border-color: rgba(255, 107, 107, 0.5);
}

body.dark-mode .sentiment-neutral {
    color: #A5B4C5;
    border-color: rgba(165, 180, 197, 0.5);
}

/* Primary buttons */
body.dark-mode .btn-primary {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
    font-weight: 600;
}

body.dark-mode .btn-primary:hover {
    background: linear-gradient(135deg, #00E6FF, #00B3E6);
    box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
}

body.dark-mode .daily-mix-recommended-badge {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
}

/* Reaction buttons */
body.dark-mode .reaction-btn {
    color: #A5B4C5;
}

body.dark-mode .reaction-btn:hover {
    background-color: rgba(0, 217, 255, 0.1);
}

body.dark-mode .reaction-btn.active {
    color: #FFFFFF;
}

/* User avatar */
body.dark-mode .user-avatar {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
}

/* Spinner */
body.dark-mode .spinner {
    border-color: rgba(165, 180, 197, 0.2);
    border-top-color: #00D9FF;
}

/* Cache indicators */
body.dark-mode .cache-indicator {
    background: rgba(0, 217, 255, 0.15);
    border: 1px solid rgba(0, 217, 255, 0.4);
    color: #00D9FF;
    box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

/* Auth modal */
body.dark-mode .auth-modal {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.98), rgba(28, 21, 5, 0.98));
    backdrop-filter: blur(15px);
    border: 1px solid rgba(0, 217, 255, 0.3);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 50px rgba(0, 217, 255, 0.2);
}

body.dark-mode .auth-header h2 {
    color: #00D9FF;
    text-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

body.dark-mode .auth-header p {
    color: #8B9DAF;
}

body.dark-mode .form-group label {
    color: #A5B4C5;
}

body.dark-mode .form-group input {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.7), rgba(28, 21, 5, 0.7));
    backdrop-filter: blur(5px);
    border: 1px solid rgba(0, 217, 255, 0.25);
    color: #C5D3E0;
}

body.dark-mode .form-group input::placeholder {
    color: #7A8C9E;
}

body.dark-mode .form-group input:focus {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    border-color: #00D9FF;
    box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2), 0 0 15px rgba(0, 217, 255, 0.3);
}

body.dark-mode .auth-switch {
    color: #8B9DAF;
}

body.dark-mode .auth-switch a {
    color: #00D9FF;
}

body.dark-mode .auth-modal-close {
    color: #A5B4C5;
}

body.dark-mode .auth-modal-close:hover {
    color: #00D9FF;
}

/* Cards - Translucent Glass Effect */
body.dark-mode .news-card {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 217, 255, 0.15);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

body.dark-mode .news-card:hover {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.95), rgba(28, 21, 5, 0.95));
    border-color: rgba(0, 217, 255, 0.4);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4), 0 0 20px rgba(0, 217, 255, 0.2);
}

body.dark-mode .daily-mix-card {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 217, 255, 0.15);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

body.dark-mode .daily-mix-card:hover {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.95), rgba(28, 21, 5, 0.95));
    border-color: rgba(0, 217, 255, 0.4);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4), 0 0 20px rgba(0, 217, 255, 0.2);
}

body.dark-mode .sidebar-widget {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.8), rgba(28, 21, 5, 0.8));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 217, 255, 0.12);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
}

body.dark-mode .sidebar-widget:hover {
    border-color: rgba(0, 217, 255, 0.25);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
}

body.dark-mode .analysis-card {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 217, 255, 0.15);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

body.dark-mode .stat-card {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 217, 255, 0.15);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

body.dark-mode .stat-card:hover {
    border-color: rgba(0, 217, 255, 0.35);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4), 0 0 15px rgba(0, 217, 255, 0.15);
    transform: translateY(-2px);
}

body.dark-mode .bookmark-item:hover {
    background: rgba(0, 217, 255, 0.08);
    border-left: 3px solid #00D9FF;
    padding-left: 12px;
    box-shadow: inset 0 0 15px rgba(0, 217, 255, 0.1);
}

body.dark-mode .carousel-container {
    border: 1px solid rgba(0, 217, 255, 0.2);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4), 0 0 30px rgba(0, 217, 255, 0.1);
}

body.dark-mode .daily-mix-empty {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.6), rgba(28, 21, 5, 0.6));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 217, 255, 0.2);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

body.dark-mode .modal-content {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.98), rgba(28, 21, 5, 0.98));
    backdrop-filter: blur(15px);
    border: 1px solid rgba(0, 217, 255, 0.25);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 40px rgba(0, 217, 255, 0.15);
}

body.dark-mode .similar-article {
    border-bottom: 1px solid rgba(0, 217, 255, 0.1);
}

body.dark-mode .similar-article:hover {
    background: rgba(0, 217, 255, 0.08);
    border-left: 3px solid #00D9FF;
    padding-left: 18px;
}

body.dark-mode .similar-article h4 {
    color: #C5D3E0;
}

body.dark-mode .similar-article p {
    color: #8B9DAF;
}

body.dark-mode .user-dropdown {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.95), rgba(28, 21, 5, 0.95));
    backdrop-filter: blur(12px);
    border: 1px solid rgba(0, 217, 255, 0.25);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 30px rgba(0, 217, 255, 0.15);
}

body.dark-mode .user-dropdown-item {
    color: #C5D3E0;
}

body.dark-mode .user-dropdown-item:hover {
    background: rgba(0, 217, 255, 0.1);
    color: #00D9FF;
}

body.dark-mode .navbar {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(0, 217, 255, 0.2);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
}

body.dark-mode .footer {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    backdrop-filter: blur(12px);
    border-top: 1px solid rgba(0, 217, 255, 0.2);
}

body.dark-mode .social-links a {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.8), rgba(28, 21, 5, 0.8));
    backdrop-filter: blur(5px);
    border: 1px solid rgba(0, 217, 255, 0.2);
    color: #A5B4C5;
}

body.dark-mode .social-links a:hover {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
    border-color: #00D9FF;
    box-shadow: 0 0 15px rgba(0, 217, 255, 0.4);
}

body.dark-mode .bookmark-btn {
    background: rgba(1, 18, 31, 0.9);
    backdrop-filter: blur(5px);
    border: 1px solid rgba(0, 217, 255, 0.3);
}

body.dark-mode .bookmark-btn:hover {
    background: rgba(0, 217, 255, 0.15);
    border-color: #00D9FF;
    box-shadow: 0 0 12px rgba(0, 217, 255, 0.4);
}

body.dark-mode .bookmark-btn.bookmarked {
    color: #00D9FF;
    background: rgba(0, 217, 255, 0.2);
    box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

body.dark-mode .daily-mix-scroll-btn {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.9), rgba(28, 21, 5, 0.9));
    backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 217, 255, 0.3);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
}

body.dark-mode .daily-mix-scroll-btn:hover {
    background: rgba(0, 217, 255, 0.15);
    border-color: #00D9FF;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5), 0 0 20px rgba(0, 217, 255, 0.4);
}

body.dark-mode .carousel-nav {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    backdrop-filter: blur(8px);
    border: 1px solid rgba(0, 217, 255, 0.3);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
}

body.dark-mode .carousel-nav:hover {
    background: rgba(0, 217, 255, 0.2);
    border-color: #00D9FF;
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
}

body.dark-mode .carousel-nav i {
    color: #00D9FF;
}

body.dark-mode .indicator {
    background-color: rgba(165, 180, 197, 0.3);
    border: 1px solid rgba(0, 217, 255, 0.2);
}

body.dark-mode .indicator.active {
    background-color: #00D9FF;
    box-shadow: 0 0 10px rgba(0, 217, 255, 0.6);
}

body.dark-mode .daily-mix-category {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
    box-shadow: 0 0 10px rgba(0, 217, 255, 0.3);
}

/* ========== END DARK MODE STYLING ========== */
/* ========== Z-INDEX FIX ========== */

.navbar {
    position: sticky;
    top: 0;
    z-index: 9000;
    background-color: var(--light);
}

body.dark-mode .navbar {
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.85), rgba(28, 21, 5, 0.85));
    backdrop-filter: blur(12px);
}

.user-dropdown {
    z-index: 9999 !important;
}

.user-menu {
    z-index: 9998;
}

.carousel-container,
.daily-mix-carousel-container {
    z-index: 1;
}

.auth-overlay {
    z-index: 10000 !important;
}

.modal {
    z-index: 10001 !important;
}

/* ========== END Z-INDEX FIX ========== */

/* ========== CREDIBILITY & REVIEW SYSTEM STYLES ========== */


.review-actions {
    display: flex;
    gap: 8px;
    margin-top: 8px;
}

.btn-review {
    padding: 6px 12px;
    font-size: 13px;
    border: 1px solid var(--gray-light);
    background-color: white;
    color: var(--dark);
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-review:hover {
    background-color: var(--primary);
    color: white;
    border-color: var(--primary);
}

.dark-mode .btn-review {
    background-color: #475569;
    border-color: #64748b;
    color: var(--light);
}

.dark-mode .btn-review:hover {
    background-color: var(--primary);
    color: white;
}


.slider-container {
    width: 100%;
}

.slider-container input[type="range"] {
    width: 100%;
    margin: 10px 0;
}

.slider-value {
    text-align: center;
    font-weight: 600;
    font-size: 18px;
    color: var(--primary);
}

.review-item {
    padding: 15px;
    border-bottom: 1px solid var(--gray-light);
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.review-author {
    font-weight: 600;
    color: var(--dark);
}

.dark-mode .review-author {
    color: var(--light);
}

.review-date {
    font-size: 12px;
    color: var(--gray);
}

.review-ratings {
    display: flex;
    gap: 15px;
    margin: 10px 0;
    font-size: 12px;
}

.review-vote-buttons {
    display: flex;
    gap: 8px;
    margin-top: 10px;
}

.vote-btn {
    padding: 4px 12px;
    border: 1px solid var(--gray-light);
    background-color: white;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s;
}

.vote-btn:hover {
    background-color: var(--gray-light);
}

.dark-mode .vote-btn {
    background-color: #475569;
    border-color: #64748b;
    color: var(--light);
}

.admin-dashboard {
    padding: 20px;
}

.pending-articles-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.pending-article-card {
    padding: 15px;
    border: 1px solid var(--gray-light);
    border-radius: 8px;
    background-color: white;
}

.dark-mode .pending-article-card {
    background-color: #334155;
    border-color: #64748b;
}

.admin-actions {
    display: flex;
    gap: 8px;
    margin-top: 10px;
}

.btn-approve {
    background-color: var(--success);
    color: white;
}

.btn-reject {
    background-color: var(--danger);
    color: white;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.stat-card {
    padding: 20px;
    border-radius: 8px;
    background-color: var(--gray-light);
    text-align: center;
}

.dark-mode .stat-card {
    background-color: #475569;
}

.stat-value {
    font-size: 32px;
    font-weight: 700;
    color: var(--primary);
    margin: 10px 0;
}

.stat-label {
    font-size: 14px;
    color: var(--gray);
}

.submit-article-btn {
    padding: 8px 16px;
    background-color: var(--success);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: all 0.3s;
}

.submit-article-btn:hover {
    opacity: 0.9;
}

/* ========== END CREDIBILITY & REVIEW SYSTEM STYLES ========== */

.newsletter-section {
    padding: 15px;
}

.newsletter-section p {
    font-size: 14px;
    color: var(--gray);
    margin-bottom: 15px;
    line-height: 1.5;
}

.newsletter-subscribed {
    text-align: center;
}

.newsletter-subscribed i {
    font-size: 48px;
    color: var(--success);
    margin-bottom: 10px;
}

.newsletter-subscribed h4 {
    font-size: 16px;
    margin-bottom: 8px;
    color: var(--dark);
}

.dark-mode .newsletter-subscribed h4 {
    color: var(--light);
}

.newsletter-subscribed p {
    font-size: 13px;
    color: var(--gray);
    margin-bottom: 15px;
}

.newsletter-preferences {
    background-color: var(--gray-light);
    border-radius: 8px;
    padding: 12px;
    margin: 15px 0;
}

.dark-mode .newsletter-preferences {
    background-color: #475569;
}

.newsletter-preferences p {
    margin: 5px 0;
    font-size: 13px;
}

.newsletter-preferences strong {
    color: var(--primary);
}

.btn-newsletter {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
}

.btn-subscribe {
    background-color: var(--primary);
    color: white;
}

.btn-subscribe:hover {
    background-color: var(--primary-light);
}

.btn-unsubscribe {
    background-color: var(--danger);
    color: white;
}

.btn-unsubscribe:hover {
    opacity: 0.9;
}

.btn-manage {
    background-color: var(--secondary);
    color: white;
}

.btn-manage:hover {
    opacity: 0.9;
}

.newsletter-login-prompt {
    text-align: center;
    padding: 20px 15px;
}

.newsletter-login-prompt i {
    font-size: 40px;
    color: var(--gray);
    margin-bottom: 12px;
}

.newsletter-login-prompt p {
    margin-bottom: 15px;
}

/* Newsletter Modal */
.newsletter-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 10002;
    align-items: center;
    justify-content: center;
}

.newsletter-modal.active {
    display: flex;
}

.newsletter-modal-content {
    background-color: white;
    border-radius: 16px;
    padding: 30px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.dark-mode .newsletter-modal-content {
    background-color: #334155;
}

.newsletter-modal-close {
    float: right;
    font-size: 24px;
    cursor: pointer;
    color: var(--gray);
}

.newsletter-modal-close:hover {
    color: var(--primary);
}

.newsletter-modal-content h2 {
    margin: 0 0 20px 0;
    color: var(--primary);
}

.newsletter-form-group {
    margin-bottom: 20px;
}

.newsletter-form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
    font-size: 14px;
    color: var(--gray);
}

.newsletter-form-group select {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid var(--gray-light);
    font-size: 14px;
}

.dark-mode .newsletter-form-group select {
    background-color: #475569;
    border-color: #64748b;
    color: var(--light);
}

.newsletter-categories {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.category-checkbox {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 6px 12px;
    background-color: var(--gray-light);
    border-radius: 20px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.3s;
}

.dark-mode .category-checkbox {
    background-color: #475569;
}

.category-checkbox input {
    cursor: pointer;
}

.category-checkbox:hover {
    background-color: var(--primary-light);
    color: white;
}

.newsletter-modal-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.newsletter-modal-actions button {
    flex: 1;
    padding: 12px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}


/* ========== AI SUMMARY TOOLTIP - GLOBAL POSITIONING ========== */
.ai-summary-tooltip {
    position: fixed;
    width: 340px;
    padding: 20px;
    border-radius: 12px;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: scale(0.95);
    transition: opacity 0.3s ease, transform 0.3s ease;
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.98), rgba(28, 21, 5, 0.98));
    backdrop-filter: blur(15px);
    border: 1px solid rgba(0, 217, 255, 0.3);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5), 0 0 40px rgba(0, 217, 255, 0.15);
}

.ai-summary-tooltip.active {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: scale(1);
}

.ai-summary-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 12px;
    font-size: 16px;
    font-weight: 600;
    color: #00D9FF;
}

.ai-summary-content {
    font-size: 14px;
    line-height: 1.6;
    color: #C5D3E0;
}

/* Loading animation */
.ai-summary-loading {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    color: #8B9DAF;
}

.ai-summary-loading .typing-dots {
    display: flex;
    gap: 4px;
}

.ai-summary-loading .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background-color: #00D9FF;
    animation: typing-bounce 1.2s ease-in-out infinite;
}

.ai-summary-loading .dot:nth-child(2) {
    animation-delay: 0.15s;
}

.ai-summary-loading .dot:nth-child(3) {
    animation-delay: 0.3s;
}

@keyframes typing-bounce {
    0%, 60%, 100% {
        transform: translateY(0);
    }
    30% {
        transform: translateY(-6px);
    }
}

/* Light mode styles */
body:not(.dark-mode) .ai-summary-tooltip {
    background: white;
    border: 1px solid var(--gray-light);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
}

body:not(.dark-mode) .ai-summary-header {
    color: var(--primary);
}

body:not(.dark-mode) .ai-summary-content,
body:not(.dark-mode) .ai-summary-loading {
    color: var(--dark);
}

body:not(.dark-mode) .ai-summary-loading .dot {
    background-color: var(--primary);
}

/* ========== END AI SUMMARY TOOLTIP ========== */

/* ========== AI CHATBOT ========== */
.ai-chat-button {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 217, 255, 0.4), 0 0 30px rgba(0, 217, 255, 0.3);
    z-index: 8000;
    transition: all 0.3s;
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% {
        transform: translateY(0);
    }
    50% {
        transform: translateY(-10px);
    }
}

.ai-chat-button:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(0, 217, 255, 0.6), 0 0 40px rgba(0, 217, 255, 0.4);
}

.ai-chat-button i {
    font-size: 24px;
    color: #01121F;
}

.ai-chat-button .pulse {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    opacity: 0.5;
    animation: pulse-ring 2s ease-out infinite;
}

@keyframes pulse-ring {
    0% {
        transform: scale(1);
        opacity: 0.5;
    }
    100% {
        transform: scale(1.5);
        opacity: 0;
    }
}

.ai-chat-window {
    position: fixed;
    bottom: 100px;
    right: 30px;
    width: 380px;
    height: 500px;
    background: linear-gradient(145deg, rgba(1, 18, 31, 0.98), rgba(28, 21, 5, 0.98));
    backdrop-filter: blur(15px);
    border: 1px solid rgba(0, 217, 255, 0.3);
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6), 0 0 50px rgba(0, 217, 255, 0.2);
    display: none;
    flex-direction: column;
    z-index: 8500;
    animation: slideUp 0.3s ease-out;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.ai-chat-window.active {
    display: flex;
}

.chat-header {
    padding: 20px;
    background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 153, 204, 0.2));
    border-bottom: 1px solid rgba(0, 217, 255, 0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 16px 16px 0 0;
}

.chat-header h3 {
    color: #00D9FF;
    font-size: 18px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.chat-header button {
    background: none;
    border: none;
    color: #A5B4C5;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s;
}

.chat-header button:hover {
    color: #00D9FF;
}

.chat-messages {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.chat-messages::-webkit-scrollbar {
    width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
    background: rgba(10, 14, 26, 0.5);
}

.chat-messages::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    border-radius: 3px;
}

.message {
    max-width: 80%;
    padding: 12px 16px;
    border-radius: 12px;
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.message.bot {
    align-self: flex-start;
    background: linear-gradient(145deg, rgba(0, 217, 255, 0.15), rgba(0, 153, 204, 0.15));
    border: 1px solid rgba(0, 217, 255, 0.3);
    color: #C5D3E0;
}

.message.user {
    align-self: flex-end;
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    color: #01121F;
    font-weight: 500;
}

.message-time {
    font-size: 10px;
    opacity: 0.7;
    margin-top: 4px;
}

.typing-indicator {
    display: flex;
    gap: 4px;
    padding: 12px 16px;
    background: linear-gradient(145deg, rgba(0, 217, 255, 0.15), rgba(0, 153, 204, 0.15));
    border: 1px solid rgba(0, 217, 255, 0.3);
    border-radius: 12px;
    width: fit-content;
}

.typing-indicator .dot {
    width: 8px;
    height: 8px;
    background: #00D9FF;
    border-radius: 50%;
    animation: typing 1.4s ease-in-out infinite;
}

.typing-indicator .dot:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-indicator .dot:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typing {
    0%, 60%, 100% {
        transform: translateY(0);
    }
    30% {
        transform: translateY(-10px);
    }
}

.chat-input {
    padding: 20px;
    border-top: 1px solid rgba(0, 217, 255, 0.3);
    display: flex;
    gap: 10px;
}

.chat-input input {
    flex: 1;
    padding: 12px 16px;
    background: rgba(10, 14, 26, 0.6);
    border: 1px solid rgba(0, 217, 255, 0.3);
    border-radius: 24px;
    color: #C5D3E0;
    font-size: 14px;
    transition: all 0.3s;
}

.chat-input input::placeholder {
    color: #7A8C9E;
}

.chat-input input:focus {
    outline: none;
    border-color: #00D9FF;
    box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2);
}

.chat-input button {
    padding: 12px 24px;
    background: linear-gradient(135deg, #00D9FF, #0099CC);
    border: none;
    border-radius: 24px;
    color: #01121F;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.chat-input button:hover {
    box-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
    transform: scale(1.05);
}

/* Light mode styles for chatbot */
body:not(.dark-mode) .ai-chat-window {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.98));
    border: 1px solid rgba(79, 70, 229, 0.3);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
}

body:not(.dark-mode) .chat-header {
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
    border-bottom: 1px solid rgba(79, 70, 229, 0.3);
}

body:not(.dark-mode) .chat-header h3 {
    color: var(--primary);
}

body:not(.dark-mode) .message.bot {
    background: linear-gradient(145deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
    border: 1px solid rgba(79, 70, 229, 0.3);
    color: var(--dark);
}

body:not(.dark-mode) .chat-input input {
    background: rgba(248, 250, 252, 0.9);
    border: 1px solid var(--gray-light);
    color: var(--dark);
}

/* ========== CREDIBILITY SYSTEM STYLES ========== */
.credibility-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    background-color: rgba(255, 255, 255, 0.95);
    display: flex;
    align-items: center;
    gap: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    z-index: 5;
}

.credibility-badge.high {
    background-color: #10b981;
    color: white;
}

.credibility-badge.good {
    background-color: #f59e0b;
    color: white;
}

.credibility-badge.mixed {
    background-color: #fb923c;
    color: white;
}

.credibility-badge.low {
    background-color: #ef4444;
    color: white;
}

.verification-icon {
    font-size: 12px;
    margin-right: 2px;
}

.submit-article-btn, .write-review-btn, .view-reviews-btn {
    font-size: 12px;
    padding: 6px 12px;
}

/* Review stars */
.star-rating {
    display: flex;
    gap: 4px;
    font-size: 24px;
    cursor: pointer;
}

.star-rating i {
    color: #d1d5db;
    transition: color 0.2s;
}

.star-rating i.active {
    color: #f59e0b;
}

.star-rating i:hover,
.star-rating i:hover ~ i {
    color: #fbbf24;
}

.credibility-slider {
    width: 100%;
    height: 8px;
    border-radius: 4px;
    background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);
    outline: none;
    -webkit-appearance: none;
}

.credibility-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: white;
    border: 2px solid #4f46e5;
    cursor: pointer;
}

.credibility-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: white;
    border: 2px solid #4f46e5;
    cursor: pointer;
}

.review-card {
    background-color: var(--gray-light);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
}

.dark-mode .review-card {
    background-color: #334155;
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.review-author {
    font-weight: 600;
    color: var(--primary);
}

.review-rating {
    display: flex;
    gap: 2px;
}

.review-content {
    margin: 10px 0;
}

.review-title {
    font-weight: 600;
    margin-bottom: 5px;
}

.review-voting {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

.vote-btn {
    background: none;
    border: 1px solid var(--gray-light);
    padding: 4px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s;
}

.vote-btn:hover {
    background-color: var(--gray-light);
}

.dark-mode .vote-btn {
    border-color: #475569;
}

.dark-mode .vote-btn:hover {
    background-color: #475569;
}

/* Admin Dashboard Styles */
.admin-dashboard {
    display: none;
}

.admin-dashboard.active {
    display: block;
}

.pending-article-card {
    background-color: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.dark-mode .pending-article-card {
    background-color: #334155;
}

.admin-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.btn-approve {
    background-color: var(--success);
    color: white;
}

.btn-reject {
    background-color: var(--danger);
    color: white;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-box {
    background-color: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.dark-mode .stat-box {
    background-color: #334155;
}

.stat-number {
    font-size: 36px;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 5px;
}

.stat-label {
    font-size: 14px;
    color: var(--gray);
}

/* Media Literacy Styles */
.media-literacy-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.literacy-card {
    background-color: white;
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.dark-mode .literacy-card {
    background-color: #334155;
}

.literacy-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.15);
}

.literacy-icon {
    font-size: 32px;
    margin-bottom: 10px;
    color: var(--primary);
}

.literacy-card h3 {
    margin-bottom: 10px;
}

.literacy-article-view {
    max-width: 800px;
    margin: 0 auto;
    background-color: white;
    border-radius: 12px;
    padding: 40px;
}

.dark-mode .literacy-article-view {
    background-color: #334155;
}

.literacy-tips {
    background-color: var(--gray-light);
    border-radius: 8px;
    padding: 20px;
    margin-top: 30px;
}

.dark-mode .literacy-tips {
    background-color: #475569;
}

.tip-item {
    margin-bottom: 15px;
}

.tip-title {
    font-weight: 600;
    margin-bottom: 5px;
}

/* AI Analysis Styles */
.ai-analysis-box {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    border: 2px solid #667eea;
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
}

.dark-mode .ai-analysis-box {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
}

.ai-score-display {
    text-align: center;
    margin: 20px 0;
}

.ai-score-number {
    font-size: 48px;
    font-weight: 700;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.ai-confidence {
    font-size: 14px;
    color: var(--gray);
    margin-top: 5px;
}

.ai-reasoning {
    background-color: rgba(255, 255, 255, 0.5);
    border-left: 4px solid #667eea;
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
}

.dark-mode .ai-reasoning {
    background-color: rgba(0, 0, 0, 0.2);
}

.ai-red-flags {
    margin-top: 15px;
}

.red-flag-item {
    display: flex;
    align-items: start;
    gap: 8px;
    padding: 8px;
    background-color: rgba(239, 68, 68, 0.1);
    border-radius: 6px;
    margin-bottom: 8px;
}

.red-flag-item i {
    color: #ef4444;
    margin-top: 2px;
}

.ai-rating-section {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--gray-light);
}

.ai-rating-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border: 2px solid var(--gray-light);
    background-color: white;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 14px;
}

.dark-mode .ai-rating-btn {
    background-color: #334155;
    border-color: #475569;
}

.ai-rating-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.ai-rating-btn.helpful {
    border-color: #10b981;
    color: #10b981;
}

.ai-rating-btn.helpful:hover {
    background-color: rgba(16, 185, 129, 0.1);
}

.ai-rating-btn.not-helpful {
    border-color: #ef4444;
    color: #ef4444;
}

.ai-rating-btn.not-helpful:hover {
    background-color: rgba(239, 68, 68, 0.1);
}

.btn-ai-check {
    display: inline-flex;
    align-items: center;
    gap: 6px;
}
/* ========== END CREDIBILITY STYLES ========== */


    </style>
</head>
<body>
    
    <!-- Auth Modal -->
    <div class="auth-overlay" id="auth-overlay">
        <div class="auth-modal">
            <button class="auth-modal-close" id="auth-close">&times;</button>
            
            <!-- Login Form -->
            <div id="login-form" class="auth-form-container">
                <div class="auth-header">
                    <h2>Welcome Back!</h2>
                    <p>Login to access your personalized news feed</p>
                </div>
                <form class="auth-form" id="login-form-element">
                    <div class="form-group">
                        <label for="login-email">Email</label>
                        <input type="email" id="login-email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" placeholder="Enter your password" required>
                    </div>
                    <div class="error-message" id="login-error"></div>
                    <button type="submit" class="btn-auth btn-auth-primary" id="login-btn">
                        Login
                    </button>
                </form>
                <div class="auth-switch">
                    Don't have an account? <a id="show-signup">Sign up</a>
                </div>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="auth-form-container" style="display: none;">
                <div class="auth-header">
                    <h2>Create Account</h2>
                    <p>Join NewsPulse to stay updated</p>
                </div>
                <form class="auth-form" id="signup-form-element">
                    <div class="form-group">
                        <label for="signup-name">Full Name</label>
                        <input type="text" id="signup-name" placeholder="Enter your name" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email</label>
                        <input type="email" id="signup-email" placeholder="Enter your email" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" placeholder="Create a password (min 6 characters)" required>
                    </div>
                    <div class="error-message" id="signup-error"></div>
                    <button type="submit" class="btn-auth btn-auth-primary" id="signup-btn">
                        Sign Up
                    </button>
                </form>
                <div class="auth-switch">
                    Already have an account? <a id="show-login">Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Article Modal -->
    <div class="auth-overlay" id="submit-article-overlay">
        <div class="auth-modal">
            <button class="auth-modal-close" id="submit-article-close">&times;</button>
            <div class="auth-header">
                <h2>Submit Article</h2>
                <p>Share a news article for review</p>
            </div>
            <form class="auth-form" id="submit-article-form">
                <div class="form-group">
                    <label for="article-title">Title</label>
                    <input type="text" id="article-title" placeholder="Enter article title" required>
                </div>
                <div class="form-group">
                    <label for="article-url">URL</label>
                    <input type="url" id="article-url" placeholder="Enter article URL" required>
                </div>
                <div class="form-group">
                    <label for="article-summary">Summary</label>
                    <textarea id="article-summary" placeholder="Brief summary of the article" rows="4" style="padding: 12px 16px; border-radius: 8px; border: 1px solid var(--gray-light); font-size: 14px; font-family: inherit; resize: vertical;" required></textarea>
                </div>
                <div class="form-group">
                    <label for="article-source">Source</label>
                    <input type="text" id="article-source" placeholder="e.g., BBC News, CNN" required>
                </div>
                <div class="form-group">
                    <label for="article-category">Category</label>
                    <select id="article-category" style="padding: 12px 16px; border-radius: 8px; border: 1px solid var(--gray-light); font-size: 14px; width: 100%;" required>
                        <option value="">Select a category</option>
                        <option value="business">Business</option>
                        <option value="technology">Technology</option>
                        <option value="sports">Sports</option>
                        <option value="politics">Politics</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="health">Health</option>
                        <option value="science">Science</option>
                    </select>
                </div>
                <div class="error-message" id="submit-article-error"></div>
                <div class="success-message" style="color: var(--success); font-size: 13px; display: none;" id="submit-article-success"></div>
                <button type="submit" class="btn-auth btn-auth-primary" id="submit-article-submit">
                    Submit Article
                </button>
            </form>
        </div>
    </div>

    <!-- Review Modal -->
    <div class="auth-overlay" id="review-overlay">
        <div class="auth-modal" style="max-width: 550px;">
            <button class="auth-modal-close" id="review-close">&times;</button>
            <div class="auth-header">
                <h2>Write Review</h2>
                <p>Share your assessment of this article</p>
            </div>
            <form class="auth-form" id="review-form">
                <input type="hidden" id="review-article-id">
                
                <div class="form-group">
                    <label>Overall Rating</label>
                    <div class="star-rating" id="overall-rating">
                        <span class="star" data-value="1"></span>
                        <span class="star" data-value="2"></span>
                        <span class="star" data-value="3"></span>
                        <span class="star" data-value="4"></span>
                        <span class="star" data-value="5"></span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="credibility-rating">Credibility Score (0-100)</label>
                    <div class="slider-container">
                        <input type="range" id="credibility-rating" min="0" max="100" value="50" step="1">
                        <div class="slider-value" id="credibility-value">50</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Accuracy Rating</label>
                    <div class="star-rating" id="accuracy-rating">
                        <span class="star" data-value="1"></span>
                        <span class="star" data-value="2"></span>
                        <span class="star" data-value="3"></span>
                        <span class="star" data-value="4"></span>
                        <span class="star" data-value="5"></span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Sourcing Rating</label>
                    <div class="star-rating" id="sourcing-rating">
                        <span class="star" data-value="1"></span>
                        <span class="star" data-value="2"></span>
                        <span class="star" data-value="3"></span>
                        <span class="star" data-value="4"></span>
                        <span class="star" data-value="5"></span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Bias Rating</label>
                    <div class="star-rating" id="bias-rating">
                        <span class="star" data-value="1"></span>
                        <span class="star" data-value="2"></span>
                        <span class="star" data-value="3"></span>
                        <span class="star" data-value="4"></span>
                        <span class="star" data-value="5"></span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="review-title">Review Title</label>
                    <input type="text" id="review-title" placeholder="Brief title for your review" required>
                </div>
                
                <div class="form-group">
                    <label for="review-comment">Your Review</label>
                    <textarea id="review-comment" placeholder="Share your detailed thoughts..." rows="4" style="padding: 12px 16px; border-radius: 8px; border: 1px solid var(--gray-light); font-size: 14px; font-family: inherit; resize: vertical;" required></textarea>
                </div>
                
                <div class="error-message" id="review-error"></div>
                <div class="success-message" style="color: var(--success); font-size: 13px; display: none;" id="review-success"></div>
                <button type="submit" class="btn-auth btn-auth-primary" id="review-submit">
                    Submit Review
                </button>
            </form>
        </div>
    </div>

    <!-- View Reviews Modal -->
    <div class="auth-overlay" id="view-reviews-overlay">
        <div class="auth-modal" style="max-width: 650px; max-height: 80vh; overflow-y: auto;">
            <button class="auth-modal-close" id="view-reviews-close">&times;</button>
            <div class="auth-header">
                <h2>Article Reviews</h2>
                <p id="reviews-article-title"></p>
            </div>
            <div id="reviews-list">
                <!-- Reviews will be loaded here -->
            </div>
        </div>
    </div>

    <!-- My Contributions Modal -->
    <div class="auth-overlay" id="contributions-overlay">
        <div class="auth-modal" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <button class="auth-modal-close" id="contributions-close">&times;</button>
            <div class="auth-header">
                <h2>My Contributions</h2>
                <p>Your articles and reviews</p>
            </div>
            <div id="contributions-content">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- AI Analysis Modal -->
    <div class="auth-overlay" id="ai-analysis-overlay">
        <div class="auth-modal" style="max-width: 700px; max-height: 80vh; overflow-y: auto;">
            <button class="auth-modal-close" id="ai-analysis-close">&times;</button>
            <div class="auth-header">
                <h2><i class="fas fa-robot"></i> AI Credibility Analysis</h2>
                <p id="ai-analysis-article-title"></p>
            </div>
            <div id="ai-analysis-content">
                <div class="loading"><div class="spinner"></div></div>
            </div>
        </div>
    </div>

    <div class="container">
        <header class="navbar">
            <div class="nav-left">
                <a href="#" class="logo"> NewsPulse</a>
                <div class="nav-links" id="nav-links">
                    <a href="#" class="nav-link active" data-page="for-you">For You</a>
                    <a href="#" class="nav-link" data-page="trending">Trending</a>
                    <a href="#" class="nav-link" data-page="analysis">Analysis</a>
                    <a href="#" class="nav-link" data-page="media-literacy">Media Literacy</a>
                    <a href="#" class="nav-link" data-page="admin-dashboard" id="admin-nav-link" style="display: none;">Admin</a>
                </div>
            </div>
            <div class="nav-right">
                <div class="mode-switch">
                    <span id="mode-label">Light Mode</span>
                    <label class="switch">
                        <input type="checkbox" id="mode-toggle">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div class="search-bar" id="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search headlines..." id="search-input">
                </div>
                
                <!-- Submit Article Button (shown when logged in) -->
                <button class="submit-article-btn" id="submit-article-btn" style="display: none;">
                    <i class="fas fa-plus"></i> Submit Article
                </button>
                
                <!-- Login Button (shown when logged out) -->
                <button class="btn-login" id="show-auth-btn">Login</button>

                <!-- User Menu (shown when logged in) -->
                <div class="user-menu" id="user-menu" style="display: none;">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-dropdown" id="user-dropdown">
                        <div class="user-dropdown-item" id="user-name-display">
                            <i class="fas fa-user"></i>
                            <span id="user-name-text">User</span>
                        </div>
                        <div class="user-dropdown-item" id="reputation-display" style="display: none;">
                            <i class="fas fa-star"></i>
                            <span>Reputation: <span id="reputation-score">0</span></span>
                        </div>
                        <div class="user-dropdown-item" id="my-contributions-btn">
                            <i class="fas fa-list"></i>
                            <span>My Contributions</span>
                        </div>
                        <div class="user-dropdown-item" id="logout-btn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- For You Page -->
        <div class="page-content active" id="for-you-page">
            <div class="main-content">
                <main class="feed">
                    <!-- Trending News Carousel -->
                    <section class="trending-news">
                        <div class="section-header">
                            <h2>Trending News <span id="cache-status-carousel"></span></h2>
                        </div>
                        <div id="carousel-loading" class="loading">
                            <div class="spinner"></div>
                        </div>
                        <div class="carousel-container" id="carousel-container" style="display: none;">
                            <div class="carousel" id="carousel">
                                <!-- Carousel items will be populated here -->
                            </div>
                            <div class="carousel-nav carousel-prev">
                                <i class="fas fa-chevron-left"></i>
                            </div>
                            <div class="carousel-nav carousel-next">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                            <div class="carousel-indicators" id="carousel-indicators">
                                <!-- Indicators will be populated here -->
                            </div>
                        </div>
                    </section>

                    <!-- ========== YOUR DAILY MIX SECTION ========== -->
                    <section class="daily-mix-section" id="daily-mix-section">
                        <div class="daily-mix-header">
                            <div class="daily-mix-title">
                                <div>
                                    <h2> Your Daily Mix</h2>
                                    <p class="daily-mix-subtitle">Personalized news recommendations</p>
                                </div>
                            </div>
                        </div>

                        <div id="daily-mix-loading" class="loading" style="display: none;">
                            <div class="spinner"></div>
                        </div>

                        <div id="daily-mix-content">
                            <!-- Recommendations will be loaded here -->
                        </div>
                    </section>
                    <!-- ========== END DAILY MIX SECTION ========== -->

                    <!-- Category Filters -->
                    <section class="category-section">
                        <h2>Filter by Category</h2>
                        <div class="category-container">
                            <button class="category-btn active" data-category="all">All</button>
                            <button class="category-btn" data-category="business">Business</button>
                            <button class="category-btn" data-category="technology">Technology</button>
                            <button class="category-btn" data-category="sports">Sports</button>
                            <button class="category-btn" data-category="politics">Politics</button>
                            <button class="category-btn" data-category="entertainment">Entertainment</button>
                            <button class="category-btn" data-category="health">Health</button>
                            <button class="category-btn" data-category="science">Science</button>
                        </div>
                    </section>

                    <!-- News Grid -->
                    <section class="news-section">
                        <div class="section-header">
                            <h2>Latest News <span id="cache-status"></span></h2>
                        </div>
                        
                        <div id="news-loading" class="loading">
                            <div class="spinner"></div>
                        </div>
                        
                        <div class="news-container" id="news-container" style="display: none;">
                            <!-- News articles will be populated here -->
                        </div>
                    </section>

                    <!-- Analysis Section -->
                    <section class="analysis-section">
                        <h2>News Analysis</h2>
                        <div class="analysis-container">
                            <div class="analysis-card">
                                <h3>Sentiment Distribution</h3>
                                <div class="chart-container">
                                    <canvas id="sentiment-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>News Source Distribution</h3>
                                <div class="chart-container">
                                    <canvas id="source-chart"></canvas>
                                </div>
                            </div>
                        </div>
                    </section>
                </main>

                <aside class="sidebar">
                    <div class="sidebar-widget">
                        <h3>TRENDING TOPICS</h3>
                        <div class="trending-topics" id="trending-topics">
                            <!-- Trending topics will be populated here -->
                        </div>
                    </div>

                    <div class="sidebar-widget">
                        <h3>FILTERS</h3>
                        <div class="filters">
                            <label for="country-select">Country:</label>
                            <select id="country-select" name="country">
                                <option value="">Global</option>
                                <option value="us">United States</option>
                                <option value="gb">United Kingdom</option>
                                <option value="in">India</option>
                                <option value="ca">Canada</option>
                                <option value="au">Australia</option>
                                <option value="de">Germany</option>
                                <option value="fr">France</option>
                                <option value="jp">Japan</option>
                                <option value="cn">China</option>
                                <option value="br">Brazil</option>
                            </select>
                            
                            <label for="lang-select">Language:</label>
                            <select id="lang-select" name="language">
                                <option value="en">English</option>
                                <option value="hi"> (Hindi)</option>
                                <option value="mr"> (Marathi)</option>
                                <option value="ta"> (Tamil)</option>
                                
                                <option value="fr">Franais (French)</option>
                                <option value="es">Espaol (Spanish)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="sidebar-widget">
                        <h3>BOOKMARKED ARTICLES</h3>
                        <div class="bookmarked-articles" id="bookmarked-articles">
                            <p class="empty-state">Login to view bookmarks</p>
                        </div>
                    </div>
                    <div class="sidebar-widget" id="newsletter-widget">
                        <h3> NEWSLETTER</h3>
                        <div id="newsletter-content">
                             <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- Trending Page -->
        <div class="page-content" id="trending-page">
            <div class="main-content">
                <main class="feed">
                    <section class="trending-news">
                        <div class="section-header">
                            <h2>Most Popular Stories</h2>
                        </div>
                        
                        <div id="trending-loading" class="loading">
                            <div class="spinner"></div>
                        </div>
                        
                        <div class="news-container" id="trending-news-container" style="display: none;">
                            <!-- Trending news will be populated here -->
                        </div>
                    </section>
                </main>

                <aside class="sidebar">
                    <div class="sidebar-widget">
                        <h3>SENTIMENT TRENDS</h3>
                        <div class="trending-topics" id="sentiment-trends">
                            <!-- Sentiment trends will appear here -->
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- Analysis Page -->
        <div class="page-content" id="analysis-page">
            <div class="main-content">
                <main class="feed">
                    <section class="analysis-section">
                        <h2>News Analytics Dashboard</h2>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h3>Total Articles</h3>
                                <div class="value" id="stat-total">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Positive News</h3>
                                <div class="value" id="stat-positive" style="color: var(--success);">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Negative News</h3>
                                <div class="value" id="stat-negative" style="color: var(--danger);">0</div>
                            </div>
                            <div class="stat-card">
                                <h3>Neutral News</h3>
                                <div class="value" id="stat-neutral">0</div>
                            </div>
                        </div>
                        
                        <div class="analysis-container">
                            <div class="analysis-card">
                                <h3>Sentiment Distribution</h3>
                                <div class="chart-container">
                                    <canvas id="analysis-sentiment-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>Category Distribution</h3>
                                <div class="chart-container">
                                    <canvas id="category-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>News Source Distribution</h3>
                                <div class="chart-container">
                                    <canvas id="analysis-source-chart"></canvas>
                                </div>
                            </div>
                            
                            <div class="analysis-card">
                                <h3>Top Keywords</h3>
                                <div class="word-cloud" id="analysis-word-cloud">
                                    <!-- Word cloud will be generated here -->
                                </div>
                            </div>
                        </div>
                    </section>
                </main>

                <aside class="sidebar">
                    <div class="sidebar-widget">
                        <h3>KEY INSIGHTS</h3>
                        <div class="trending-topics" id="key-insights">
                            <a href="#">Analyzing data...</a>
                        </div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- Media Literacy Page -->
        <div class="page-content" id="media-literacy-page">
            <div class="main-content">
                <main class="feed">
                    <section class="media-literacy-section">
                        <div class="section-header">
                            <h2>Media Literacy Resources</h2>
                            <p>Learn to identify credible news and avoid misinformation</p>
                        </div>
                        <div id="media-literacy-loading" class="loading">
                            <div class="spinner"></div>
                        </div>
                        <div id="media-literacy-content">
                            <!-- Media literacy articles will be loaded here -->
                        </div>
                    </section>
                </main>
            </div>
        </div>

        <!-- Admin Dashboard Page -->
        <div class="page-content" id="admin-dashboard-page">
            <div class="main-content">
                <main class="feed">
                    <section class="admin-dashboard">
                        <div class="section-header">
                            <h2>Admin Dashboard</h2>
                            <p>Manage articles and monitor platform statistics</p>
                        </div>
                        
                        <div class="stats-grid" id="admin-stats">
                            <!-- Stats will be loaded here -->
                        </div>
                        
                        <div style="margin-top: 30px;">
                            <h3>Pending Articles</h3>
                            <div id="pending-articles-loading" class="loading">
                                <div class="spinner"></div>
                            </div>
                            <div class="pending-articles-list" id="pending-articles-list">
                                <!-- Pending articles will be loaded here -->
                            </div>
                        </div>
                    </section>
                </main>
            </div>
        </div>

        <!-- Similar Articles Modal -->
        <div id="similar-modal" class="modal">
            <div class="modal-content">
                <span class="modal-close">&times;</span>
                <h2>Similar Articles</h2>
                <div id="similar-loading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                </div>
                <div id="similar-articles-list">
                    <!-- Similar articles will be populated here -->
                </div>
            </div>
        </div>

         <!-- ========== GLOBAL AI SUMMARY TOOLTIP ========== -->
    <div id="ai-summary-tooltip" class="ai-summary-tooltip"></div>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-col">
                    <h4>About NewsPulse</h4>
                    <p>Bringing you trending headlines with AI-powered sentiment analysis and insights.</p>
                </div>
                <div class="footer-col">
                    <h4>Contact</h4>
                    <a href="mailto:info@newspulse.com">info@newspulse.com</a>
                </div>
                <div class="footer-col">
                    <h4>Follow Us</h4>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 NewsPulse. All rights reserved. Powered by NewsAPI.ai</p>
            </div>
        </footer>
    </div>

    <div id="newsletter-modal" class="newsletter-modal">
    <div class="newsletter-modal-content">
        <span class="newsletter-modal-close">&times;</span>
        <h2> Newsletter Preferences</h2>
        
        <form id="newsletter-preferences-form">
            <div class="newsletter-form-group">
                <label for="newsletter-frequency">Frequency:</label>
                <select id="newsletter-frequency" name="frequency">
                    <option value="daily">Daily (Every morning at 8 AM)</option>
                    <option value="weekly">Weekly (Every Monday at 8 AM)</option>
                </select>
            </div>

            <div class="newsletter-form-group">
                <label>Select Categories:</label>
                <div class="newsletter-categories">
                    <label class="category-checkbox">
                        <input type="checkbox" name="category" value="all" checked>
                        All
                    </label>
                    <label class="category-checkbox">
                        <input type="checkbox" name="category" value="business">
                        Business
                    </label>
                    <label class="category-checkbox">
                        <input type="checkbox" name="category" value="technology">
                        Technology
                    </label>
                    <label class="category-checkbox">
                        <input type="checkbox" name="category" value="sports">
                        Sports
                    </label>
                    <label class="category-checkbox">
                        <input type="checkbox" name="category" value="politics">
                        Politics
                    </label>
                    <label class="category-checkbox">
                        <input type="checkbox" name="category" value="entertainment">
                        Entertainment
                    </label>
                    <label class="category-checkbox">
                        <input type="checkbox" name="category" value="health">
                        Health
                    </label>
                    <label class="category-checkbox">
                        <input type="checkbox" name="category" value="science">
                        Science
                    </label>
                </div>
            </div>

            <div class="newsletter-modal-actions">
                <button type="submit" class="btn-newsletter btn-subscribe">
                    Save Preferences
                </button>
            </div>
        </form>
    </div>
    </div>


    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:5000/api';

        // Global state
        let currentLanguage = 'en';
        let currentUser = null;
        let authToken = null;
        let allArticles = [];
        let userBookmarks = [];
        let articleReactions = {};
        let sentimentChart = null;
        let sourceChart = null;
        let categoryChart = null;
        let analysisSentimentChart = null;
        let analysisSourceChart = null;
        let isFromCache = false;

    

        // Security: HTML sanitization function
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;',
                '/': '&#x2F;',
                '`': '&#96;'
            };
            return String(text).replace(/[&<>"'/`]/g, (char) => map[char]);
        }

        // Helper function to truncate text
        function truncateText(text, maxLength) {
            if (!text) return '';
            if (text.length <= maxLength) return text;
            return text.substr(0, maxLength).trim() + '...';
        }


        const translations = {
    en: {
        // Navbar
        logo: ' NewsPulse',
        forYou: 'For You',
        trending: 'Trending',
        analysis: 'Analysis',
        login: 'Login',
        logout: 'Logout',
        searchPlaceholder: 'Search headlines...',
        lightMode: 'Light Mode',
        darkMode: 'Dark Mode',
        
        // Auth Modal
        welcomeBack: 'Welcome Back!',
        loginSubtitle: 'Login to access your personalized news feed',
        email: 'Email',
        password: 'Password',
        fullName: 'Full Name',
        loginButton: 'Login',
        signupButton: 'Sign Up',
        dontHaveAccount: "Don't have an account?",
        alreadyHaveAccount: 'Already have an account?',
        createAccount: 'Create Account',
        joinNewsPulse: 'Join NewsPulse to stay updated',
        
        // Daily Mix
        dailyMix: ' Your Daily Mix',
        dailyMixSubtitle: 'Personalized news recommendations',
        recommended: 'Recommended',
        unlockDailyMix: 'Unlock Your Daily Mix',
        loginForRecommendations: 'Login to get personalized news recommendations',
        loginNow: 'Login Now',
        startBuildingMix: 'Start Building Your Mix',
        likeArticlesForRecs: 'Like articles to get personalized recommendations',
        exploreNews: 'Explore News',
        
        // Categories
        filterByCategory: 'Filter by Category',
        all: 'All',
        business: 'Business',
        technology: 'Technology',
        sports: 'Sports',
        politics: 'Politics',
        entertainment: 'Entertainment',
        health: 'Health',
        science: 'Science',
        
        // News Section
        trendingNews: 'Trending News',
        latestNews: 'Latest News',
        readMore: 'Read More',
        similar: 'Similar',
        readFullStory: 'Read Full Story',
        cached: ' Cached',
        fresh: ' Fresh',
        
        // Sidebar
        trendingTopics: 'TRENDING TOPICS',
        filters: 'FILTERS',
        country: 'Country:',
        language: 'Language:',
        bookmarkedArticles: 'BOOKMARKED ARTICLES',
        newsletter: ' NEWSLETTER',
        loginToViewBookmarks: 'Login to view bookmarks',
        noBookmarks: 'No bookmarked articles yet',
        
        // Newsletter
        getDailyHeadlines: 'Get daily top headlines delivered to your inbox every morning! ',
        subscribeNow: 'Subscribe Now',
        subscribed: ' Subscribed!',
        youllReceiveUpdates: "You'll receive %s updates",
        frequency: 'Frequency:',
        categories: 'Categories:',
        managePreferences: 'Manage Preferences',
        unsubscribe: 'Unsubscribe',
        daily: 'daily',
        weekly: 'weekly',
        
        // Pages
        mostPopularStories: 'Most Popular Stories',
        sentimentTrends: 'SENTIMENT TRENDS',
        newsAnalyticsDashboard: 'News Analytics Dashboard',
        totalArticles: 'Total Articles',
        positiveNews: 'Positive News',
        negativeNews: 'Negative News',
        neutralNews: 'Neutral News',
        sentimentDistribution: 'Sentiment Distribution',
        categoryDistribution: 'Category Distribution',
        newsSourceDistribution: 'News Source Distribution',
        topKeywords: 'Top Keywords',
        keyInsights: 'KEY INSIGHTS',
        
        // Similar Articles
        similarArticles: 'Similar Articles',
        noSimilarArticles: 'No similar articles found',
        
        // Sentiment & Time
        positive: 'Positive',
        negative: 'Negative',
        neutral: 'Neutral',
        recently: 'Recently',
        minutesAgo: 'minutes ago',
        hoursAgo: 'hours ago',
        daysAgo: 'days ago',
        
        // Messages
        noArticlesFound: 'No articles found',
        analyzingData: 'Analyzing data...',
        
        // Footer
        aboutNewsPulse: 'About NewsPulse',
        aboutDescription: 'Bringing you trending headlines with AI-powered sentiment analysis and insights.',
        contact: 'Contact',
        followUs: 'Follow Us',
        footerCopyright: ' 2025 NewsPulse. All rights reserved. Powered by NewsAPI.ai'
    },
    
    hi: {
        logo: ' ',
        forYou: ' ',
        trending: '',
        analysis: '',
        login: '',
        logout: '',
        searchPlaceholder: ' ...',
        lightMode: ' ',
        darkMode: ' ',
        welcomeBack: '   !',
        loginSubtitle: '         ',
        email: '',
        password: '',
        fullName: ' ',
        loginButton: ' ',
        signupButton: '  ',
        dontHaveAccount: '  ?',
        alreadyHaveAccount: '   ?',
        createAccount: ' ',
        joinNewsPulse: '      ',
        dailyMix: '   ',
        dailyMixSubtitle: '  ',
        recommended: '',
        unlockDailyMix: '    ',
        loginForRecommendations: '        ',
        loginNow: '  ',
        startBuildingMix: '    ',
        likeArticlesForRecs: '         ',
        exploreNews: '  ',
        filterByCategory: '    ',
        all: '',
        business: '',
        technology: '',
        sports: '',
        politics: '',
        entertainment: '',
        health: '',
        science: '',
        trendingNews: ' ',
        latestNews: ' ',
        readMore: ' ',
        similar: '',
        readFullStory: '  ',
        cached: ' ',
        fresh: ' ',
        trendingTopics: ' ',
        filters: '',
        country: ':',
        language: ':',
        bookmarkedArticles: '   ',
        newsletter: ' ',
        loginToViewBookmarks: '     ',
        noBookmarks: '    ',
        getDailyHeadlines: '        ! ',
        subscribeNow: '  ',
        subscribed: '  !',
        youllReceiveUpdates: ' %s   ',
        frequency: ':',
        categories: ':',
        managePreferences: '  ',
        unsubscribe: '  ',
        daily: '',
        weekly: '',
        mostPopularStories: '  ',
        sentimentTrends: ' ',
        newsAnalyticsDashboard: '  ',
        totalArticles: ' ',
        positiveNews: ' ',
        negativeNews: ' ',
        neutralNews: ' ',
        sentimentDistribution: ' ',
        categoryDistribution: ' ',
        newsSourceDistribution: '  ',
        topKeywords: ' ',
        keyInsights: ' ',
        similarArticles: ' ',
        noSimilarArticles: '    ',
        positive: '',
        negative: '',
        neutral: '',
        recently: '  ',
        minutesAgo: ' ',
        hoursAgo: ' ',
        daysAgo: ' ',
        noArticlesFound: '   ',
        analyzingData: '  ...',
        aboutNewsPulse: '   ',
        aboutDescription: '-         ',
        contact: '',
        followUs: '  ',
        footerCopyright: ' 2025    NewsAPI.ai  '
    },
    
    mr: {
        logo: ' ',
        forYou: '',
        trending: '',
        analysis: '',
        login: '',
        logout: '',
        searchPlaceholder: ' ...',
        lightMode: ' ',
        darkMode: ' ',
        welcomeBack: '  !',
        loginSubtitle: '     ',
        email: '',
        password: '',
        fullName: ' ',
        loginButton: ' ',
        signupButton: '  ',
        dontHaveAccount: ' ?',
        alreadyHaveAccount: '  ?',
        createAccount: '  ',
        joinNewsPulse: '    ',
        dailyMix: '   ',
        dailyMixSubtitle: '  ',
        recommended: ' ',
        unlockDailyMix: '    ',
        loginForRecommendations: '     ',
        loginNow: '  ',
        startBuildingMix: '     ',
        likeArticlesForRecs: '     ',
        exploreNews: '  ',
        filterByCategory: '  ',
        all: '',
        business: '',
        technology: '',
        sports: '',
        politics: '',
        entertainment: '',
        health: '',
        science: '',
        trendingNews: ' ',
        latestNews: ' ',
        readMore: ' ',
        similar: '',
        readFullStory: '  ',
        cached: '  ',
        fresh: ' ',
        trendingTopics: ' ',
        filters: '',
        country: ':',
        language: ':',
        bookmarkedArticles: '  ',
        newsletter: ' ',
        loginToViewBookmarks: '   ',
        noBookmarks: '   ',
        getDailyHeadlines: '      ! ',
        subscribeNow: '  ',
        subscribed: '  !',
        youllReceiveUpdates: ' %s  ',
        frequency: ':',
        categories: ':',
        managePreferences: '  ',
        unsubscribe: '  ',
        daily: '',
        weekly: '',
        mostPopularStories: '  ',
        sentimentTrends: ' ',
        newsAnalyticsDashboard: '  ',
        totalArticles: ' ',
        positiveNews: ' ',
        negativeNews: ' ',
        neutralNews: ' ',
        sentimentDistribution: ' ',
        categoryDistribution: ' ',
        newsSourceDistribution: '  ',
        topKeywords: ' ',
        keyInsights: ' ',
        similarArticles: ' ',
        noSimilarArticles: '    ',
        positive: '',
        negative: '',
        neutral: '',
        recently: '',
        minutesAgo: '',
        hoursAgo: '',
        daysAgo: '',
        noArticlesFound: '   ',
        analyzingData: ' ...',
        aboutNewsPulse: ' ',
        aboutDescription: '-        .',
        contact: '',
        followUs: '  ',
        footerCopyright: ' 2025     NewsAPI.ai  '
    },
    
    ta: {
        logo: ' ',
        forYou: '',
        trending: '',
        analysis: '',
        login: '',
        logout: '',
        searchPlaceholder: '  ...',
        lightMode: ' ',
        darkMode: ' ',
        welcomeBack: ' !',
        loginSubtitle: '     ',
        email: '',
        password: '',
        fullName: ' ',
        loginButton: '',
        signupButton: ' ',
        dontHaveAccount: ' ?',
        alreadyHaveAccount: '  ?',
        createAccount: ' ',
        joinNewsPulse: '     ',
        dailyMix: '   ',
        dailyMixSubtitle: '  ',
        recommended: '',
        unlockDailyMix: '   ',
        loginForRecommendations: '    ',
        loginNow: ' ',
        startBuildingMix: '   ',
        likeArticlesForRecs: '   ',
        exploreNews: ' ',
        filterByCategory: ' ',
        all: '',
        business: '',
        technology: '',
        sports: '',
        politics: '',
        entertainment: '',
        health: '',
        science: '',
        trendingNews: ' ',
        latestNews: ' ',
        readMore: ' ',
        similar: '',
        readFullStory: '  ',
        cached: ' ',
        fresh: ' ',
        trendingTopics: ' ',
        filters: '',
        country: ':',
        language: ':',
        bookmarkedArticles: '  ',
        newsletter: ' ',
        loginToViewBookmarks: '  ',
        noBookmarks: '  ',
        getDailyHeadlines: '       ! ',
        subscribeNow: ' ',
        subscribed: ' !',
        youllReceiveUpdates: ' %s  ',
        frequency: ':',
        categories: ':',
        managePreferences: ' ',
        unsubscribe: '',
        daily: '',
        weekly: '',
        mostPopularStories: '  ',
        sentimentTrends: ' ',
        newsAnalyticsDashboard: '  ',
        totalArticles: ' ',
        positiveNews: ' ',
        negativeNews: ' ',
        neutralNews: ' ',
        sentimentDistribution: ' ',
        categoryDistribution: ' ',
        newsSourceDistribution: '  ',
        topKeywords: '  ',
        keyInsights: ' ',
        similarArticles: ' ',
        noSimilarArticles: '   ',
        positive: '',
        negative: '',
        neutral: '',
        recently: '',
        minutesAgo: ' ',
        hoursAgo: ' ',
        daysAgo: ' ',
        noArticlesFound: '  ',
        analyzingData: '  ...',
        aboutNewsPulse: ' ',
        aboutDescription: 'AI-         .',
        contact: '',
        followUs: ' ',
        footerCopyright: ' 2025 .   . NewsAPI.ai  '
    },
    
    es: {
        logo: ' NewsPulse',
        forYou: 'Para Ti',
        trending: 'Tendencias',
        analysis: 'Anlisis',
        login: 'Iniciar Sesin',
        logout: 'Cerrar Sesin',
        searchPlaceholder: 'Buscar titulares...',
        lightMode: 'Modo Claro',
        darkMode: 'Modo Oscuro',
        welcomeBack: 'Bienvenido de Nuevo!',
        loginSubtitle: 'Inicia sesin para acceder a tu feed personalizado',
        email: 'Correo Electrnico',
        password: 'Contrasea',
        fullName: 'Nombre Completo',
        loginButton: 'Iniciar Sesin',
        signupButton: 'Registrarse',
        dontHaveAccount: 'No tienes cuenta?',
        alreadyHaveAccount: 'Ya tienes cuenta?',
        createAccount: 'Crear Cuenta',
        joinNewsPulse: 'nete a NewsPulse para mantenerte actualizado',
        dailyMix: ' Tu Mezcla Diaria',
        dailyMixSubtitle: 'Recomendaciones de noticias personalizadas',
        recommended: 'Recomendado',
        unlockDailyMix: 'Desbloquea Tu Mezcla Diaria',
        loginForRecommendations: 'Inicia sesin para obtener recomendaciones',
        loginNow: 'Iniciar Sesin Ahora',
        startBuildingMix: 'Comienza a Construir Tu Mezcla',
        likeArticlesForRecs: 'Dale me gusta a artculos para obtener recomendaciones',
        exploreNews: 'Explorar Noticias',
        filterByCategory: 'Filtrar por Categora',
        all: 'Todos',
        business: 'Negocios',
        technology: 'Tecnologa',
        sports: 'Deportes',
        politics: 'Poltica',
        entertainment: 'Entretenimiento',
        health: 'Salud',
        science: 'Ciencia',
        trendingNews: 'Noticias en Tendencia',
        latestNews: 'ltimas Noticias',
        readMore: 'Leer Ms',
        similar: 'Similar',
        readFullStory: 'Leer Historia Completa',
        cached: ' Cach',
        fresh: ' Nuevo',
        trendingTopics: 'TEMAS POPULARES',
        filters: 'FILTROS',
        country: 'Pas:',
        language: 'Idioma:',
        bookmarkedArticles: 'ARTCULOS GUARDADOS',
        newsletter: ' BOLETN',
        loginToViewBookmarks: 'Inicia sesin para ver marcadores',
        noBookmarks: 'No hay artculos guardados',
        getDailyHeadlines: 'Recibe titulares principales cada maana! ',
        subscribeNow: 'Suscribirse Ahora',
        subscribed: ' Suscrito!',
        youllReceiveUpdates: 'Recibirs actualizaciones %s',
        frequency: 'Frecuencia:',
        categories: 'Categoras:',
        managePreferences: 'Gestionar Preferencias',
        unsubscribe: 'Cancelar Suscripcin',
        daily: 'diario',
        weekly: 'semanal',
        mostPopularStories: 'Historias Ms Populares',
        sentimentTrends: 'TENDENCIAS DE SENTIMIENTO',
        newsAnalyticsDashboard: 'Panel de Anlisis de Noticias',
        totalArticles: 'Artculos Totales',
        positiveNews: 'Noticias Positivas',
        negativeNews: 'Noticias Negativas',
        neutralNews: 'Noticias Neutrales',
        sentimentDistribution: 'Distribucin de Sentimiento',
        categoryDistribution: 'Distribucin de Categoras',
        newsSourceDistribution: 'Distribucin de Fuentes',
        topKeywords: 'Palabras Clave Principales',
        keyInsights: 'INFORMACIN CLAVE',
        similarArticles: 'Artculos Similares',
        noSimilarArticles: 'No se encontraron artculos similares',
        positive: 'Positivo',
        negative: 'Negativo',
        neutral: 'Neutral',
        recently: 'Recientemente',
        minutesAgo: 'minutos atrs',
        hoursAgo: 'horas atrs',
        daysAgo: 'das atrs',
        noArticlesFound: 'No se encontraron artculos',
        analyzingData: 'Analizando datos...',
        aboutNewsPulse: 'Acerca de NewsPulse',
        aboutDescription: 'Trayendo titulares de tendencia con anlisis de sentimiento impulsado por IA.',
        contact: 'Contacto',
        followUs: 'Sguenos',
        footerCopyright: ' 2025 NewsPulse. Todos los derechos reservados. Powered by NewsAPI.ai'
    },
    
    fr: {
        logo: ' NewsPulse',
        forYou: 'Pour Vous',
        trending: 'Tendances',
        analysis: 'Analyse',
        login: 'Connexion',
        logout: 'Dconnexion',
        searchPlaceholder: 'Rechercher des titres...',
        lightMode: 'Mode Clair',
        darkMode: 'Mode Sombre',
        welcomeBack: 'Bon Retour!',
        loginSubtitle: 'Connectez-vous pour accder  votre flux personnalis',
        email: 'E-mail',
        password: 'Mot de passe',
        fullName: 'Nom Complet',
        loginButton: 'Connexion',
        signupButton: "S'inscrire",
        dontHaveAccount: "Pas de compte?",
        alreadyHaveAccount: 'Dj un compte?',
        createAccount: 'Crer un Compte',
        joinNewsPulse: 'Rejoignez NewsPulse pour rester  jour',
        dailyMix: ' Votre Mix Quotidien',
        dailyMixSubtitle: 'Recommandations de nouvelles personnalises',
        recommended: 'Recommand',
        unlockDailyMix: 'Dverrouillez Votre Mix Quotidien',
        loginForRecommendations: 'Connectez-vous pour obtenir des recommandations',
        loginNow: 'Se Connecter Maintenant',
        startBuildingMix: 'Commencez  Construire Votre Mix',
        likeArticlesForRecs: "Aimez des articles pour obtenir des recommandations",
        exploreNews: 'Explorer les Nouvelles',
        filterByCategory: 'Filtrer par Catgorie',
        all: 'Tous',
        business: 'Affaires',
        technology: 'Technologie',
        sports: 'Sports',
        politics: 'Politique',
        entertainment: 'Divertissement',
        health: 'Sant',
        science: 'Science',
        trendingNews: 'Nouvelles Tendance',
        latestNews: 'Dernires Nouvelles',
        readMore: 'Lire Plus',
        similar: 'Similaire',
        readFullStory: "Lire l'Histoire Complte",
        cached: ' En Cache',
        fresh: ' Nouveau',
        trendingTopics: 'SUJETS TENDANCE',
        filters: 'FILTRES',
        country: 'Pays:',
        language: 'Langue:',
        bookmarkedArticles: 'ARTICLES FAVORIS',
        newsletter: ' BULLETIN',
        loginToViewBookmarks: 'Connectez-vous pour voir les favoris',
        noBookmarks: 'Aucun article favori',
        getDailyHeadlines: 'Recevez les principaux titres chaque matin! ',
        subscribeNow: "S'abonner Maintenant",
        subscribed: ' Abonn!',
        youllReceiveUpdates: 'Vous recevrez des mises  jour %s',
        frequency: 'Frquence:',
        categories: 'Catgories:',
        managePreferences: 'Grer les Prfrences',
        unsubscribe: 'Se Dsabonner',
        daily: 'quotidien',
        weekly: 'hebdomadaire',
        mostPopularStories: 'Histoires les Plus Populaires',
        sentimentTrends: 'TENDANCES DE SENTIMENT',
        newsAnalyticsDashboard: "Tableau de Bord d'Analyse des Nouvelles",
        totalArticles: 'Articles Totaux',
        positiveNews: 'Nouvelles Positives',
        negativeNews: 'Nouvelles Ngatives',
        neutralNews: 'Nouvelles Neutres',
        sentimentDistribution: 'Distribution du Sentiment',
        categoryDistribution: 'Distribution des Catgories',
        newsSourceDistribution: 'Distribution des Sources',
        topKeywords: 'Mots-cls Principaux',
        keyInsights: 'INFORMATIONS CLS',
        similarArticles: 'Articles Similaires',
        noSimilarArticles: 'Aucun article similaire trouv',
        positive: 'Positif',
        negative: 'Ngatif',
        neutral: 'Neutre',
        recently: 'Rcemment',
        minutesAgo: 'minutes il y a',
        hoursAgo: 'heures il y a',
        daysAgo: 'jours il y a',
        noArticlesFound: 'Aucun article trouv',
        analyzingData: 'Analyse des donnes...',
        aboutNewsPulse: ' Propos de NewsPulse',
        aboutDescription: "Apporter des titres tendance avec l'analyse de sentiment IA.",
        contact: 'Contact',
        followUs: 'Suivez-nous',
        footerCopyright: ' 2025 NewsPulse. Tous droits rservs. Powered by NewsAPI.ai'
    }
};

// Translation Helper Function
function t(key) {
    return translations[currentLanguage]?.[key] || translations['en'][key] || key;
}

// Update ALL UI with translations
function updateUILanguage() {
    console.log(' Updating UI language to:', currentLanguage);
    
    // Navbar
    const logo = document.querySelector('.logo');
    if (logo) logo.textContent = t('logo');
    
    document.querySelectorAll('.nav-link').forEach(link => {
        const page = link.dataset.page;
        if (page === 'for-you') link.textContent = t('forYou');
        if (page === 'trending') link.textContent = t('trending');
        if (page === 'analysis') link.textContent = t('analysis');
    });
    
    const loginBtn = document.getElementById('show-auth-btn');
    if (loginBtn) loginBtn.textContent = t('login');
    
    const searchInput = document.getElementById('search-input');
    if (searchInput) searchInput.placeholder = t('searchPlaceholder');
    
    const modeLabel = document.getElementById('mode-label');
    if (modeLabel) {
        const isDark = document.getElementById('mode-toggle').checked;
        modeLabel.textContent = isDark ? t('darkMode') : t('lightMode');
    }
    
    // Auth Modal
    updateAuthModal();
    
    // Daily Mix
    updateDailyMixSection();
    
    // Categories
    updateCategories();
    
    // News Sections
    updateNewsSections();
    
    // Sidebar
    updateSidebar();
    
    // Pages
    updatePages();
    
    // Footer
    updateFooter();
    
    // Dynamic content
    updateDynamicContent();
}

function updateAuthModal() {
    // Login form
    const loginHeader = document.querySelector('#login-form .auth-header h2');
    if (loginHeader) loginHeader.textContent = t('welcomeBack');
    
    const loginSubtitle = document.querySelector('#login-form .auth-header p');
    if (loginSubtitle) loginSubtitle.textContent = t('loginSubtitle');
    
    // Signup form
    const signupHeader = document.querySelector('#signup-form .auth-header h2');
    if (signupHeader) signupHeader.textContent = t('createAccount');
    
    const signupSubtitle = document.querySelector('#signup-form .auth-header p');
    if (signupSubtitle) signupSubtitle.textContent = t('joinNewsPulse');
    
    // Labels
    document.querySelectorAll('label[for*="email"]').forEach(label => {
        label.textContent = t('email');
    });
    
    document.querySelectorAll('label[for*="password"]').forEach(label => {
        label.textContent = t('password');
    });
    
    const nameLabel = document.querySelector('label[for="signup-name"]');
    if (nameLabel) nameLabel.textContent = t('fullName');
    
    // Buttons
    const loginButton = document.getElementById('login-btn');
    if (loginButton && !loginButton.disabled) {
        loginButton.textContent = t('loginButton');
    }
    
    const signupButton = document.getElementById('signup-btn');
    if (signupButton && !signupButton.disabled) {
        signupButton.textContent = t('signupButton');
    }
    
    // Auth switches
    const loginSwitchDiv = document.querySelector('#login-form .auth-switch');
    if (loginSwitchDiv) {
        loginSwitchDiv.innerHTML = t('dontHaveAccount') + ' <a id="show-signup">' + t('signupButton') + '</a>';
        // Re-attach event listener
        document.getElementById('show-signup').addEventListener('click', () => {
            document.getElementById('login-form').style.display = 'none';
            document.getElementById('signup-form').style.display = 'block';
        });
    }
    
    const signupSwitchDiv = document.querySelector('#signup-form .auth-switch');
    if (signupSwitchDiv) {
        signupSwitchDiv.innerHTML = t('alreadyHaveAccount') + ' <a id="show-login">' + t('loginButton') + '</a>';
        // Re-attach event listener
        document.getElementById('show-login').addEventListener('click', () => {
            document.getElementById('signup-form').style.display = 'none';
            document.getElementById('login-form').style.display = 'block';
        });
    }
}

function updateDailyMixSection() {
    const dailyMixTitle = document.querySelector('.daily-mix-title h2');
    if (dailyMixTitle) dailyMixTitle.textContent = t('dailyMix');
    
    const dailyMixSubtitle = document.querySelector('.daily-mix-subtitle');
    if (dailyMixSubtitle) dailyMixSubtitle.textContent = t('dailyMixSubtitle');
    
    // Update Daily Mix empty states
    const dailyMixEmpty = document.querySelector('.daily-mix-empty');
    if (dailyMixEmpty) {
        const h3 = dailyMixEmpty.querySelector('h3');
        const p = dailyMixEmpty.querySelector('p');
        const btn = dailyMixEmpty.querySelector('.btn');
        
        if (h3) {
            if (h3.textContent.includes('Unlock')) h3.textContent = t('unlockDailyMix');
            if (h3.textContent.includes('Start')) h3.textContent = t('startBuildingMix');
        }
        if (p) {
            if (p.textContent.includes('Login')) p.textContent = t('loginForRecommendations');
            if (p.textContent.includes('Like')) p.textContent = t('likeArticlesForRecs');
        }
        if (btn) {
            if (btn.textContent.includes('Login')) btn.textContent = t('loginNow');
            if (btn.textContent.includes('Explore')) btn.textContent = t('exploreNews');
        }
    }
    
    // Update "Recommended" badges
    document.querySelectorAll('.daily-mix-recommended-badge').forEach(badge => {
        const icon = badge.querySelector('i');
        badge.textContent = t('recommended');
        if (icon) badge.prepend(icon);
    });
}

function updateCategories() {
    const categoryHeader = document.querySelector('.category-section h2');
    if (categoryHeader) categoryHeader.textContent = t('filterByCategory');
    
    document.querySelectorAll('.category-btn').forEach(btn => {
        const category = btn.dataset.category;
        btn.textContent = t(category);
    });
}

function updateNewsSections() {
    // Update section headers
    document.querySelectorAll('.section-header h2').forEach(header => {
        const text = header.textContent.trim();
        let cacheSpan = header.querySelector('span');
        
        if (text.includes('Trending News') || text.includes('') || text.includes('')) {
            header.textContent = t('trendingNews') + ' ';
            if (cacheSpan) header.appendChild(cacheSpan);
        } else if (text.includes('Latest News') || text.includes('') || text.includes('')) {
            header.textContent = t('latestNews') + ' ';
            if (cacheSpan) header.appendChild(cacheSpan);
        }
    });
}

function updateSidebar() {
    document.querySelectorAll('.sidebar-widget h3').forEach(h3 => {
        const text = h3.textContent.trim();
        if (text.includes('TRENDING') || text.includes('') || text.includes('')) {
            h3.textContent = t('trendingTopics');
        }
        if (text.includes('FILTER') || text.includes('') || text.includes('')) {
            h3.textContent = t('filters');
        }
        if (text.includes('BOOKMARK') || text.includes('') || text.includes('')) {
            h3.textContent = t('bookmarkedArticles');
        }
        if (text.includes('NEWSLETTER') || text.includes('') || text.includes('')) {
            h3.textContent = t('newsletter');
        }
    });
    
    // Filter labels
    const countryLabel = document.querySelector('label[for="country-select"]');
    if (countryLabel) countryLabel.textContent = t('country');
    
    const langLabel = document.querySelector('label[for="lang-select"]');
    if (langLabel) langLabel.textContent = t('language');
}

function updatePages() {
    // Trending Page
    const trendingHeader = document.querySelector('#trending-page .section-header h2');
    if (trendingHeader) trendingHeader.textContent = t('mostPopularStories');
    
    const sentimentTrendsHeader = document.querySelector('#trending-page .sidebar-widget h3');
    if (sentimentTrendsHeader && sentimentTrendsHeader.textContent.includes('SENTIMENT')) {
        sentimentTrendsHeader.textContent = t('sentimentTrends');
    }
    
    // Analysis Page
    const analyticsHeader = document.querySelector('#analysis-page h2');
    if (analyticsHeader && (analyticsHeader.textContent.includes('Analytics') || analyticsHeader.textContent.includes(''))) {
        analyticsHeader.textContent = t('newsAnalyticsDashboard');
    }
    
    // Stat cards
    document.querySelectorAll('.stat-card h3').forEach(h3 => {
        const text = h3.textContent.trim();
        if (text.includes('Total') || text.includes('') || text.includes('')) {
            h3.textContent = t('totalArticles');
        }
        if (text.includes('Positive') || text.includes('') || text.includes('')) {
            h3.textContent = t('positiveNews');
        }
        if (text.includes('Negative') || text.includes('') || text.includes('')) {
            h3.textContent = t('negativeNews');
        }
        if (text.includes('Neutral') || text.includes('') || text.includes('')) {
            h3.textContent = t('neutralNews');
        }
    });
    
    // Analysis cards
    document.querySelectorAll('.analysis-card h3').forEach(h3 => {
        const text = h3.textContent.trim();
        if (text.includes('Sentiment Distribution')) h3.textContent = t('sentimentDistribution');
        if (text.includes('Category Distribution')) h3.textContent = t('categoryDistribution');
        if (text.includes('Source Distribution')) h3.textContent = t('newsSourceDistribution');
        if (text.includes('Keywords')) h3.textContent = t('topKeywords');
    });
}

function updateFooter() {
    document.querySelectorAll('.footer-col h4').forEach(h4 => {
        const text = h4.textContent.trim();
        if (text.includes('About')) h4.textContent = t('aboutNewsPulse');
        if (text === 'Contact') h4.textContent = t('contact');
        if (text.includes('Follow')) h4.textContent = t('followUs');
    });
    
    const aboutDesc = document.querySelector('.footer-col p');
    if (aboutDesc && aboutDesc.textContent.includes('Bringing')) {
        aboutDesc.textContent = t('aboutDescription');
    }
    
    const footerCopyright = document.querySelector('.footer-bottom p');
    if (footerCopyright) footerCopyright.textContent = t('footerCopyright');
}

function updateDynamicContent() {
    // Update Read More buttons
    document.querySelectorAll('.read-more').forEach(btn => {
        if (btn.textContent.includes('Read More') || btn.textContent.includes('') || btn.textContent.includes('Leer')) {
            btn.textContent = t('readMore');
        }
        if (btn.textContent.includes('Full Story') || btn.textContent.includes('') || btn.textContent.includes('')) {
            btn.textContent = t('readFullStory');
        }
    });
    
    // Update Similar buttons
    document.querySelectorAll('.find-similar, .btn-similar').forEach(btn => {
        btn.textContent = t('similar');
    });
    
    // Update cache indicators
    document.querySelectorAll('.cache-indicator').forEach(indicator => {
        if (indicator.textContent.includes('Cached') || indicator.textContent.includes('')) {
            indicator.textContent = t('cached');
        } else if (indicator.textContent.includes('Fresh') || indicator.textContent.includes('')) {
            indicator.textContent = t('fresh');
        }
    });
    
    // Update empty states
    document.querySelectorAll('.empty-state').forEach(state => {
        const text = state.textContent.trim();
        if (text.includes('No articles')) state.textContent = t('noArticlesFound');
        if (text.includes('Login to view')) state.textContent = t('loginToViewBookmarks');
        if (text.includes('No bookmarked')) state.textContent = t('noBookmarks');
        if (text.includes('Analyzing')) state.textContent = t('analyzingData');
    });
}

// Override getSentimentLabel function
function getSentimentLabel(sentiment) {
    if (sentiment > 0.1) return t('positive');
    if (sentiment < -0.1) return t('negative');
    return t('neutral');
}

// Override formatTime function
function formatTime(dateString) {
    if (!dateString) return t('recently');
    
    const date = new Date(dateString);
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 60) return `${diffMins} ${t('minutesAgo')}`;
    if (diffHours < 24) return `${diffHours} ${t('hoursAgo')}`;
    if (diffDays < 7) return `${diffDays} ${t('daysAgo')}`;
    return date.toLocaleDateString();
}

// Initialize language on page load
document.addEventListener('DOMContentLoaded', function() {
    // Load saved language preference
    const savedLang = localStorage.getItem('preferredLanguage');
    if (savedLang && translations[savedLang]) {
        currentLanguage = savedLang;
        const langSelect = document.getElementById('lang-select');
        if (langSelect) langSelect.value = savedLang;
        updateUILanguage();
    }
});

// Language selector change handler
function setupLanguageSelector() {
    const langSelect = document.getElementById('lang-select');
    if (!langSelect) return;
    
    // Store original change handler
    const originalOnChange = langSelect.onchange;
    
    langSelect.addEventListener('change', function() {
        const newLang = this.value;
        console.log(' Language changed to:', newLang);
        
        // Update current language
        currentLanguage = newLang;
        
        // Save preference
        localStorage.setItem('preferredLanguage', newLang);
        
        // Update all UI text
        updateUILanguage();
        
        // Call original handler if exists (for news filtering)
        if (originalOnChange) {
            originalOnChange.call(this);
        }
    });
}

// Call this in your main initialization
console.log(' i18n Translation System Loaded');
setupLanguageSelector();



        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            checkAuthStatus();
            setupEventListeners();
            initializeCharts();
            initAISummaries(); // <-- ADD THIS LINE
            initChatbot(); 
        });

        // Auth Functions
        function checkAuthStatus() {
            const token = localStorage.getItem('authToken');
            const user = localStorage.getItem('user');

            if (token && user) {
                authToken = token;
                currentUser = JSON.parse(user);
                updateUIForLoggedInUser();
                updateUserUIAfterLogin();
                loadUserBookmarks().then(() => {
                    loadNewsFromAPI();
                    loadDailyMix();
                });
            } else {
                updateUIForLoggedOutUser();
                loadNewsFromAPI();
                showDailyMixLoginPrompt();
            }
        }

        function updateUIForLoggedInUser() {
            document.getElementById('show-auth-btn').style.display = 'none';
            document.getElementById('user-menu').style.display = 'block';
            document.getElementById('nav-links').style.display = 'flex';
            document.getElementById('search-bar').style.display = 'flex';

            const userAvatar = document.getElementById('user-avatar');
            const userNameText = document.getElementById('user-name-text');
            
            userAvatar.textContent = currentUser.name.charAt(0).toUpperCase();
            userNameText.textContent = currentUser.name;
        }

        function updateUIForLoggedOutUser() {
            document.getElementById('show-auth-btn').style.display = 'block';
            document.getElementById('user-menu').style.display = 'none';
            document.getElementById('nav-links').style.display = 'flex';
            document.getElementById('search-bar').style.display = 'flex';

            const bookmarksContainer = document.getElementById('bookmarked-articles');
            bookmarksContainer.innerHTML = '<p class="empty-state">Login to view bookmarks</p>';
        }

        async function handleSignup(e) {
            e.preventDefault();
            
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const errorDiv = document.getElementById('signup-error');
            const submitBtn = document.getElementById('signup-btn');

            errorDiv.classList.remove('active');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Creating Account...';

            try {
                const response = await fetch(`${API_BASE_URL}/auth/signup`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Signup failed');
                }

                localStorage.setItem('authToken', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                authToken = data.token;
                currentUser = data.user;

                document.getElementById('auth-overlay').classList.remove('active');
                updateUIForLoggedInUser();
                updateUserUIAfterLogin();
                
                await loadUserBookmarks();
                await loadNewsFromAPI();
                await loadDailyMix();

            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.add('active');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Sign Up';
            }
        }

        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');
            const submitBtn = document.getElementById('login-btn');

            errorDiv.classList.remove('active');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Logging in...';

            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Login failed');
                }

                localStorage.setItem('authToken', data.token);
                localStorage.setItem('user', JSON.stringify(data.user));
                authToken = data.token;
                currentUser = data.user;

                document.getElementById('auth-overlay').classList.remove('active');
                updateUIForLoggedInUser();
                
                await loadUserBookmarks();
                await loadNewsFromAPI();
                await loadDailyMix();

            } catch (error) {
                errorDiv.textContent = error.message;
                errorDiv.classList.add('active');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Login';
            }
        }

        function handleLogout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('user');
            authToken = null;
            currentUser = null;
            userBookmarks = [];
            articleReactions = {};

            updateUIForLoggedOutUser();
            loadNewsFromAPI();
            showDailyMixLoginPrompt();
            
            // Hide submit article button
            const submitBtn = document.getElementById('submit-article-btn');
            if (submitBtn) submitBtn.style.display = 'none';
            
            // Hide admin nav
            const adminNav = document.getElementById('admin-nav-link');
            if (adminNav) adminNav.style.display = 'none';
            
            // Hide reputation
            document.getElementById('reputation-display').style.display = 'none';
        }

        // ========== DAILY MIX FUNCTIONS ========== 
        
        async function loadDailyMix() {
            if (!authToken) {
                showDailyMixLoginPrompt();
                return;
            }

            const loadingDiv = document.getElementById('daily-mix-loading');
            const contentDiv = document.getElementById('daily-mix-content');

            loadingDiv.style.display = 'flex';
            contentDiv.innerHTML = '';

            try {
                console.log(' Fetching Daily Mix recommendations...');
                
                const response = await fetch(`${API_BASE_URL}/recommendations?limit=15`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                loadingDiv.style.display = 'none';

                if (data.success && data.recommendations && data.recommendations.length > 0) {
                    console.log(` Loaded ${data.recommendations.length} recommendations`);
                    displayDailyMix(data.recommendations);
                } else {
                    console.log(' No recommendations available');
                    showDailyMixEmpty();
                }
            } catch (error) {
                console.error(' Error loading daily mix:', error);
                loadingDiv.style.display = 'none';
                showDailyMixEmpty();
            }
        }

        function displayDailyMix(recommendations) {
            const contentDiv = document.getElementById('daily-mix-content');
            
            const carouselWrapper = document.createElement('div');
            carouselWrapper.className = 'daily-mix-carousel-wrapper';
            
            const carouselContainer = document.createElement('div');
            carouselContainer.className = 'daily-mix-carousel-container';
            
            const carousel = document.createElement('div');
            carousel.className = 'daily-mix-carousel';
            carousel.id = 'daily-mix-carousel';
            
            recommendations.forEach((article, index) => {
                const card = createDailyMixCard(article, index);
                carousel.appendChild(card);
            });
            
            carouselContainer.appendChild(carousel);
            carouselWrapper.appendChild(carouselContainer);
            
            // Add scroll buttons OUTSIDE the carousel container
            const leftBtn = document.createElement('div');
            leftBtn.className = 'daily-mix-scroll-btn daily-mix-scroll-left';
            leftBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            leftBtn.onclick = () => scrollDailyMix('left');
            
            const rightBtn = document.createElement('div');
            rightBtn.className = 'daily-mix-scroll-btn daily-mix-scroll-right';
            rightBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            rightBtn.onclick = () => scrollDailyMix('right');
            
            carouselWrapper.appendChild(leftBtn);
            carouselWrapper.appendChild(rightBtn);
            
            contentDiv.appendChild(carouselWrapper);
            
            // Initial button state update
            setTimeout(() => {
                updateDailyMixScrollButtons();
            }, 100);
            
            // Add scroll listener
            carousel.addEventListener('scroll', updateDailyMixScrollButtons);
        }

        function createDailyMixCard(article, index) {
            const card = document.createElement('div');
            card.className = 'daily-mix-card';
            
            const sentiment = getSentimentLabel(article.sentiment);
            const sentimentEmoji = sentiment === 'Positive' ? '' : sentiment === 'Negative' ? '' : '';
            
            // Truncate title and summary
            const truncatedTitle = truncateText(article.title, 80);
            const truncatedSummary = truncateText(article.summary, 120);
            
            card.innerHTML = `
                <div class="daily-mix-card-image">
                    <img src="${article.image || 'https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=800'}" 
                         alt="${article.title}" 
                         onerror="this.src='https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=800'">
                    <div class="daily-mix-recommended-badge">
                        <i class="fas fa-star"></i> Recommended
                    </div>
                </div>
                <div class="daily-mix-card-content">
                    <h3 title="${article.title}">${truncatedTitle}</h3>
                    <p title="${article.summary}">${truncatedSummary}</p>
                    <div class="daily-mix-meta">
                        <span class="daily-mix-category">${article.category || 'General'}</span>
                        <span>${sentimentEmoji} ${sentiment}</span>
                    </div>
                </div>
            `;
            
            card.onclick = () => window.open(article.url, '_blank');
            
            return card;
        }

        function scrollDailyMix(direction) {
            const carousel = document.getElementById('daily-mix-carousel');
            if (!carousel) return;
            
            const scrollAmount = 320; // card width + gap
            
            if (direction === 'left') {
                carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
            } else {
                carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
            
            // Update buttons after scroll
            setTimeout(updateDailyMixScrollButtons, 300);
        }

        function updateDailyMixScrollButtons() {
            const carousel = document.getElementById('daily-mix-carousel');
            const leftBtn = document.querySelector('.daily-mix-scroll-left');
            const rightBtn = document.querySelector('.daily-mix-scroll-right');
            
            if (!carousel || !leftBtn || !rightBtn) return;
            
            const isAtStart = carousel.scrollLeft <= 10;
            const isAtEnd = carousel.scrollLeft >= (carousel.scrollWidth - carousel.clientWidth - 10);
            
            leftBtn.classList.toggle('disabled', isAtStart);
            rightBtn.classList.toggle('disabled', isAtEnd);
        }

        function showDailyMixLoginPrompt() {
            const contentDiv = document.getElementById('daily-mix-content');
            contentDiv.innerHTML = `
                <div class="daily-mix-empty">
                    <i class="fas fa-lock"></i>
                    <h3>Unlock Your Daily Mix</h3>
                    <p>Login to get personalized news recommendations</p>
                    <button class="btn" onclick="document.getElementById('auth-overlay').classList.add('active')">
                        Login Now
                    </button>
                </div>
            `;
        }

        function showDailyMixEmpty() {
            const contentDiv = document.getElementById('daily-mix-content');
            contentDiv.innerHTML = `
                <div class="daily-mix-empty">
                    <i class="fas fa-heart"></i>
                    <h3>Start Building Your Mix</h3>
                    <p>Like articles to get personalized recommendations</p>
                    <button class="btn" onclick="document.querySelector('.news-section').scrollIntoView({ behavior: 'smooth' })">
                        Explore News
                    </button>
                </div>
            `;
        }

        // ========== END DAILY MIX FUNCTIONS ========== 
        async function loadUserBookmarks() {
            if (!authToken) {
                userBookmarks = [];
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/bookmarks`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    userBookmarks = data.bookmarks;
                    console.log('Loaded bookmarks:', userBookmarks.length);
                    updateBookmarksUI();
                }
            } catch (error) {
                console.error('Error loading bookmarks:', error);
                userBookmarks = [];
            }
        }


        async function loadNewsletterStatus() {
    const widget = document.getElementById('newsletter-content');
    
    if (!authToken) {
        widget.innerHTML = `
            <div class="newsletter-login-prompt">
                <i class="fas fa-envelope"></i>
                <p>Login to subscribe to our daily newsletter</p>
                <button class="btn-newsletter btn-subscribe" onclick="document.getElementById('auth-overlay').classList.add('active')">
                    Login to Subscribe
                </button>
            </div>
        `;
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/newsletter/status`, {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });

        const data = await response.json();

        if (data.success) {
            if (data.subscribed) {
                displaySubscribedNewsletter(data.preferences);
            } else {
                displayUnsubscribedNewsletter();
            }
        }
    } catch (error) {
        console.error('Error loading newsletter status:', error);
        widget.innerHTML = '<p class="empty-state">Error loading newsletter</p>';
    }
}

function displaySubscribedNewsletter(preferences) {
    const widget = document.getElementById('newsletter-content');
    
    const categories = preferences.categories.join(', ');
    const frequency = preferences.frequency.charAt(0).toUpperCase() + preferences.frequency.slice(1);
    
    widget.innerHTML = `
        <div class="newsletter-subscribed">
            <i class="fas fa-check-circle"></i>
            <h4> Subscribed!</h4>
            <p>You'll receive ${frequency.toLowerCase()} updates</p>
            
            <div class="newsletter-preferences">
                <p><strong>Frequency:</strong> ${frequency}</p>
                <p><strong>Categories:</strong> ${categories}</p>
            </div>
            
            <button class="btn-newsletter btn-manage" onclick="openNewsletterModal()">
                <i class="fas fa-cog"></i> Manage Preferences
            </button>
            
            <button class="btn-newsletter btn-unsubscribe" onclick="unsubscribeNewsletter()">
                Unsubscribe
            </button>
        </div>
    `;
}

function displayUnsubscribedNewsletter() {
    const widget = document.getElementById('newsletter-content');
    
    widget.innerHTML = `
        <div class="newsletter-section">
            <p>Get daily top headlines delivered to your inbox every morning! </p>
            <button class="btn-newsletter btn-subscribe" onclick="subscribeNewsletter()">
                <i class="fas fa-envelope"></i> Subscribe Now
            </button>
        </div>
    `;
}

async function subscribeNewsletter() {
    if (!authToken) {
        document.getElementById('auth-overlay').classList.add('active');
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/newsletter/subscribe`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({
                frequency: 'daily',
                categories: ['all']
            })
        });

        const data = await response.json();

        if (data.success) {
            alert(' Successfully subscribed to newsletter!');
            loadNewsletterStatus();
        } else {
            alert(' Error: ' + data.message);
        }
    } catch (error) {
        console.error('Error subscribing:', error);
        alert(' Failed to subscribe');
    }
}

async function unsubscribeNewsletter() {
    if (!confirm('Are you sure you want to unsubscribe from the newsletter?')) {
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/newsletter/unsubscribe`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });

        const data = await response.json();

        if (data.success) {
            alert(' Successfully unsubscribed');
            loadNewsletterStatus();
        } else {
            alert(' Error: ' + data.message);
        }
    } catch (error) {
        console.error('Error unsubscribing:', error);
        alert(' Failed to unsubscribe');
    }
}

function openNewsletterModal() {
    document.getElementById('newsletter-modal').classList.add('active');
    loadCurrentPreferences();
}

async function loadCurrentPreferences() {
    try {
        const response = await fetch(`${API_BASE_URL}/newsletter/status`, {
            headers: {
                'Authorization': `Bearer ${authToken}`
            }
        });

        const data = await response.json();

        if (data.success && data.preferences) {
            document.getElementById('newsletter-frequency').value = data.preferences.frequency;
            
            // Uncheck all categories first
            document.querySelectorAll('[name="category"]').forEach(cb => cb.checked = false);
            
            // Check saved categories
            data.preferences.categories.forEach(cat => {
                const checkbox = document.querySelector(`[name="category"][value="${cat}"]`);
                if (checkbox) checkbox.checked = true;
            });
        }
    } catch (error) {
        console.error('Error loading preferences:', error);
    }
}

// Newsletter modal event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Close modal
    const newsletterModalClose = document.querySelector('.newsletter-modal-close');
    if (newsletterModalClose) {
        newsletterModalClose.addEventListener('click', () => {
            document.getElementById('newsletter-modal').classList.remove('active');
        });
    }

    // Close modal on outside click
    const newsletterModal = document.getElementById('newsletter-modal');
    if (newsletterModal) {
        newsletterModal.addEventListener('click', (e) => {
            if (e.target === newsletterModal) {
                newsletterModal.classList.remove('active');
            }
        });
    }

    // Newsletter preferences form
    const newsletterForm = document.getElementById('newsletter-preferences-form');
    if (newsletterForm) {
        newsletterForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const frequency = document.getElementById('newsletter-frequency').value;
            const categories = Array.from(document.querySelectorAll('[name="category"]:checked'))
                .map(cb => cb.value);
            
            if (categories.length === 0) {
                alert('Please select at least one category');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/newsletter/preferences`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ frequency, categories })
                });

                const data = await response.json();

                if (data.success) {
                    alert(' Preferences updated successfully!');
                    document.getElementById('newsletter-modal').classList.remove('active');
                    loadNewsletterStatus();
                } else {
                    alert(' Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error updating preferences:', error);
                alert(' Failed to update preferences');
            }
        });
    }

    // Load newsletter status on page load
    setTimeout(loadNewsletterStatus, 500);
});


        function updateBookmarksUI() {
            const container = document.getElementById('bookmarked-articles');
            container.innerHTML = '';

            if (userBookmarks.length === 0) {
                container.innerHTML = '<p class="empty-state">No bookmarked articles yet</p>';
                return;
            }

            userBookmarks.slice(0, 5).forEach(bookmark => {
                const item = document.createElement('div');
                item.className = 'bookmark-item';
                item.innerHTML = `
                    <h4>${bookmark.title}</h4>
                    <span>${bookmark.source}</span>
                `;
                item.onclick = () => window.open(bookmark.url, '_blank');
                container.appendChild(item);
            });
        }

        async function toggleBookmark(article, btnElement) {
            if (!authToken) {
                document.getElementById('auth-overlay').classList.add('active');
                return;
            }

            const isBookmarked = btnElement.classList.contains('bookmarked');

            try {
                if (isBookmarked) {
                    const bookmark = userBookmarks.find(b => b.articleId === article.id);
                    if (bookmark) {
                        const response = await fetch(`${API_BASE_URL}/bookmarks/${bookmark._id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${authToken}`
                            }
                        });

                        const data = await response.json();

                        if (data.success) {
                            userBookmarks = userBookmarks.filter(b => b._id !== bookmark._id);
                            btnElement.classList.remove('bookmarked');
                            btnElement.querySelector('i').classList.remove('fas');
                            btnElement.querySelector('i').classList.add('far');
                            updateBookmarksUI();
                            console.log('Bookmark removed');
                        }
                    }
                } else {
                    const response = await fetch(`${API_BASE_URL}/bookmarks`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            articleId: article.id,
                            title: article.title,
                            summary: article.summary,
                            image: article.image,
                            source: article.source,
                            url: article.url,
                            category: article.category,
                            sentiment: article.sentiment
                        })
                    });

                    const data = await response.json();

                    if (data.success) {
                        userBookmarks.unshift(data.bookmark);
                        btnElement.classList.add('bookmarked');
                        btnElement.querySelector('i').classList.remove('far');
                        btnElement.querySelector('i').classList.add('fas');
                        updateBookmarksUI();
                        console.log('Bookmark added');
                    } else {
                        throw new Error(data.message);
                    }
                }
            } catch (error) {
                console.error('Error toggling bookmark:', error);
                alert('Error: ' + error.message);
            }
        }

        // Reaction Functions
        async function handleReaction(articleId, reactionType, btnElement) {
            if (!authToken) {
                document.getElementById('auth-overlay').classList.add('active');
                return;
            }

            console.log(' Handling reaction:', { articleId, reactionType, user: currentUser?.email });

            try {
                const response = await fetch(`${API_BASE_URL}/reactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        articleId,
                        reactionType
                    })
                });

                const data = await response.json();

                if (data.success) {
                    console.log(' Server response:', data);
                    
                    // Update global article reactions
                    articleReactions[articleId] = data.counts;
                    
                    // Update the article in allArticles array
                    const articleIndex = allArticles.findIndex(a => a.id === articleId);
                    if (articleIndex !== -1) {
                        allArticles[articleIndex].reactions = data.counts;
                    }
                    
                    // Find ALL cards with this article ID and update them
                    const allCards = document.querySelectorAll(`[data-article-id="${articleId}"]`);
                    console.log(` Found ${allCards.length} cards to update`);
                    
                    allCards.forEach(card => {
                        const reactionsContainer = card.querySelector('.reactions');
                        if (reactionsContainer) {
                            // Update button active states
                            const allReactionBtns = reactionsContainer.querySelectorAll('.reaction-btn');
                            allReactionBtns.forEach(btn => {
                                const btnType = btn.getAttribute('data-type');
                                if (btnType === reactionType) {
                                    btn.classList.add('active');
                                } else {
                                    btn.classList.remove('active');
                                }
                            });
                            
                            // Update counts
                            const likeCountSpan = reactionsContainer.querySelector('[data-type="like"] .reaction-count');
                            const dislikeCountSpan = reactionsContainer.querySelector('[data-type="dislike"] .reaction-count');
                            const neutralCountSpan = reactionsContainer.querySelector('[data-type="neutral"] .reaction-count');
                            
                            if (likeCountSpan) {
                                likeCountSpan.textContent = data.counts.like || 0;
                            }
                            if (dislikeCountSpan) {
                                dislikeCountSpan.textContent = data.counts.dislike || 0;
                            }
                            if (neutralCountSpan) {
                                neutralCountSpan.textContent = data.counts.neutral || 0;
                            }
                        }
                    });
                    
                    console.log(' All counts updated successfully!');
                    
                    // Reload daily mix after like reaction
                    if (reactionType === 'like') {
                        console.log(' Reloading Daily Mix after like...');
                        setTimeout(() => loadDailyMix(), 500);
                    }
                } else {
                    console.error(' Server returned error:', data);
                }
            } catch (error) {
                console.error(' Error in handleReaction:', error);
            }
        }

        async function loadUserReaction(articleId) {
            if (!authToken) return null;

            try {
                const response = await fetch(`${API_BASE_URL}/reactions/user/${articleId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (data.success && data.reaction) {
                    return data.reaction;
                }
            } catch (error) {
                console.error('Error loading user reaction:', error);
            }

            return null;
        }

        // News API Functions
        async function fetchNews(category = 'all', country = '', lang = 'en') {
            try {
                const params = new URLSearchParams({
                    category,
                    country,
                    lang
                });

                const response = await fetch(`${API_BASE_URL}/news?${params}`);
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success && data.articles) {
                    isFromCache = data.fromCache;
                    
                    // Update cache indicator
                    const cacheStatus = document.getElementById('cache-status');
                    const cacheStatusCarousel = document.getElementById('cache-status-carousel');
                    
                    if (cacheStatus) {
                        cacheStatus.innerHTML = data.fromCache ? 
                            '<span class="cache-indicator cached"> Cached</span>' : 
                            '<span class="cache-indicator fresh"> Fresh</span>';
                    }
                    
                    if (cacheStatusCarousel) {
                        cacheStatusCarousel.innerHTML = data.fromCache ? 
                            '<span class="cache-indicator cached"> Cached</span>' : 
                            '<span class="cache-indicator fresh"> Fresh</span>';
                    }
                    
                    allArticles = data.articles.map(article => ({
                        id: article.articleId,
                        title: article.title,
                        summary: article.summary,
                        image: article.image,
                        source: article.source,
                        time: formatTime(article.publishedAt),
                        category: article.category,
                        url: article.url,
                        sentiment: article.sentiment,
                        dateTime: article.publishedAt,
                        shares: article.shares,
                        uri: article.uri,
                        lang: article.lang,
                        reactions: article.reactions || { like: 0, dislike: 0, neutral: 0, total: 0 }
                    }));
                    
                    // Store reactions in global object
                    allArticles.forEach(article => {
                        articleReactions[article.id] = article.reactions;
                    });
                    
                    console.log(`Loaded ${allArticles.length} articles (from ${data.fromCache ? 'cache' : 'API'})`);
                    return allArticles;
                } else {
                    throw new Error('No articles found');
                }
            } catch (error) {
                console.error('Error fetching news:', error);
                return [];
            }
        }

        async function searchNews(query) {
            try {
                const langSelect = document.getElementById('lang-select');
                const lang = langSelect ? langSelect.value : 'en';
                
                const params = new URLSearchParams({
                    query,
                    lang
                });

                const response = await fetch(`${API_BASE_URL}/news/search?${params}`);
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success && data.articles) {
                    return data.articles.map(article => ({
                        id: article.articleId,
                        title: article.title,
                        summary: article.summary,
                        image: article.image,
                        source: article.source,
                        time: formatTime(article.publishedAt),
                        category: article.category,
                        url: article.url,
                        sentiment: article.sentiment,
                        dateTime: article.publishedAt,
                        shares: article.shares,
                        uri: article.uri,
                        reactions: article.reactions || { like: 0, dislike: 0, neutral: 0, total: 0 }
                    }));
                }
                
                return [];
            } catch (error) {
                console.error('Error searching news:', error);
                return [];
            }
        }

        async function findSimilarArticles(articleUri) {
            try {
                const response = await fetch(`${API_BASE_URL}/news/similar/${articleUri}`);
                
                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.success && data.articles) {
                    return data.articles;
                }
                
                return [];
            } catch (error) {
                console.error('Error finding similar articles:', error);
                return [];
            }
        }

        // Display Functions
        async function loadNewsFromAPI(category = 'all', country = '', lang = 'en') {
            const container = document.getElementById('news-container');
            const loading = document.getElementById('news-loading');
            
            loading.style.display = 'flex';
            container.style.display = 'none';
            
            const articles = await fetchNews(category, country, lang);
            
            loading.style.display = 'none';
            container.style.display = 'grid';
            
            await displayNewsArticles(articles, 'news-container');
            updateAnalytics(articles);
            loadCarousel(articles.slice(0, 5));
        }

        async function loadTrendingArticles() {
            const container = document.getElementById('trending-news-container');
            const loading = document.getElementById('trending-loading');
            const langSelect = document.getElementById('lang-select');
            const lang = langSelect ? langSelect.value : 'en';
            
            loading.style.display = 'flex';
            container.style.display = 'none';
            
            const articles = await fetchNews('all', '', lang);
            const trending = articles.sort((a, b) => {
                const aScore = (a.reactions.total || 0) + (a.shares || 0);
                const bScore = (b.reactions.total || 0) + (b.shares || 0);
                return bScore - aScore;
            }).slice(0, 20);
            
            loading.style.display = 'none';
            container.style.display = 'grid';
            
            await displayNewsArticles(trending, 'trending-news-container');
        }

        async function displayNewsArticles(articles, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (articles.length === 0) {
                container.innerHTML = '<p class="empty-state">No articles found</p>';
                return;
            }
            
            for (const article of articles) {
                const newsCard = await createNewsCard(article);
                container.appendChild(newsCard);
            }
        }

        async function createNewsCard(article) {
            const card = document.createElement('div');
            card.className = 'news-card';
            card.dataset.category = article.category;
            card.dataset.articleId = article.id;
            
            const sentiment = getSentimentLabel(article.sentiment);
            const sentimentClass = sentiment.toLowerCase();
            
            const isBookmarked = userBookmarks.some(b => b.articleId === article.id);
            
            const reactions = article.reactions || { like: 0, dislike: 0, neutral: 0, total: 0 };
            const userReaction = await loadUserReaction(article.id);
            
            let dominantSentiment = 'neutral';
            if (reactions.like > reactions.dislike && reactions.like > reactions.neutral) {
                dominantSentiment = 'positive';
            } else if (reactions.dislike > reactions.like && reactions.dislike > reactions.neutral) {
                dominantSentiment = 'negative';
            }
            
            // Fetch credibility data
            let credibilityHtml = '';
            try {
                const credResponse = await fetch(`${API_BASE_URL}/credibility/article/${article.id}`);
                if (credResponse.ok) {
                    const credData = await credResponse.json();
                    if (credData.success && credData.data) {
                        const score = credData.data.score || 0;
                        const status = credData.data.verificationStatus || 'unverified';
                        
                        let credClass = 'credibility-low';
                        let credLabel = 'Low';
                        if (score >= 80) {
                            credClass = 'credibility-high';
                            credLabel = 'High';
                        } else if (score >= 60) {
                            credClass = 'credibility-good';
                            credLabel = 'Good';
                        } else if (score >= 40) {
                            credClass = 'credibility-mixed';
                            credLabel = 'Mixed';
                        }
                        
                        const statusIcon = status === 'verified' ? '' : 
                                         status === 'disputed' ? '' : 
                                         status === 'false' ? '' : '?';
                        
                        credibilityHtml = `
                            <span class="credibility-badge ${credClass}">
                                ${credLabel} ${parseInt(score, 10)}
                                <span class="verification-icon" title="${escapeHtml(status)}">${statusIcon}</span>
                            </span>
                        `;
                    }
                }
            } catch (error) {
                console.error('Error fetching credibility:', error);
            }
            
            card.innerHTML = `
                <div class="news-image">
                    <img src="${article.image}" alt="News image" onerror="this.src='https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=800'">
                    <span class="sentiment-badge sentiment-${dominantSentiment}">
                        ${dominantSentiment === 'positive' ? '' : dominantSentiment === 'negative' ? '' : ''} ${dominantSentiment.charAt(0).toUpperCase() + dominantSentiment.slice(1)}
                    </span>
                    ${credibilityHtml}
                    ${authToken ? `
                    <button class="bookmark-btn ${isBookmarked ? 'bookmarked' : ''}" data-article-id="${article.id}">
                        <i class="${isBookmarked ? 'fas' : 'far'} fa-bookmark"></i>
                    </button>
                    ` : ''}
                </div>
                <div class="news-content">
                    <h3>${article.title}</h3>
                    <p>${article.summary}</p>
                    <div class="news-meta">
                        <span class="source">${article.source}</span>
                        <span class="time">${article.time}</span>
                    </div>
                    <div class="news-actions">
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button class="btn btn-primary read-more" data-url="${article.url}">Read More</button>
                            <button class="btn btn-similar find-similar" data-uri="${article.uri}">Similar</button>
                            <button class="btn-ai-check check-credibility" data-article-id="${article.id}" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                                <i class="fas fa-robot"></i> AI Check
                            </button>
                            ${authToken ? `
                            <button class="btn-review write-review" data-article-id="${article.id}" data-article-title="${escapeHtml(article.title)}">Write Review</button>
                            <button class="btn-review view-reviews" data-article-id="${article.id}" data-article-title="${escapeHtml(article.title)}">View Reviews</button>
                            ` : ''}
                        </div>
                        ${authToken ? `
                        <div class="reactions">
                            <button class="reaction-btn like ${userReaction === 'like' ? 'active' : ''}" data-article-id="${article.id}" data-type="like" title="Like">
                                 <span class="reaction-count" data-type="like">${reactions.like}</span>
                            </button>
                            <button class="reaction-btn dislike ${userReaction === 'dislike' ? 'active' : ''}" data-article-id="${article.id}" data-type="dislike" title="Dislike">
                                 <span class="reaction-count" data-type="dislike">${reactions.dislike}</span>
                            </button>
                            <button class="reaction-btn neutral ${userReaction === 'neutral' ? 'active' : ''}" data-article-id="${article.id}" data-type="neutral" title="Neutral">
                                 <span class="reaction-count" data-type="neutral">${reactions.neutral}</span>
                            </button>
                        </div>
                        ` : `
                        <div class="reactions">
                            <span style="font-size: 12px;"> ${reactions.like}  ${reactions.dislike}  ${reactions.neutral}</span>
                        </div>
                        `}
                    </div>
                </div>
            `;
            
            return card;
        }

        function loadCarousel(articles) {
            const carousel = document.getElementById('carousel');
            const indicators = document.getElementById('carousel-indicators');
            const container = document.getElementById('carousel-container');
            const loading = document.getElementById('carousel-loading');
            
            if (articles.length === 0) {
                loading.style.display = 'none';
                return;
            }
            
            carousel.innerHTML = '';
            indicators.innerHTML = '';
            
            articles.forEach((article, index) => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                item.innerHTML = `
                    <img src="${article.image}" alt="${article.title}" onerror="this.src='https://images.unsplash.com/photo-1585829365295-ab7cd400c167?w=1200'">
                    <div class="carousel-content">
                        <h3>${article.title}</h3>
                        <p>${article.summary}</p>
                        <button class="btn btn-primary read-more" data-url="${article.url}">Read Full Story</button>
                    </div>
                `;
                carousel.appendChild(item);
                
                const indicator = document.createElement('div');
                indicator.className = `indicator ${index === 0 ? 'active' : ''}`;
                indicator.dataset.index = index;
                indicators.appendChild(indicator);
            });
            
            loading.style.display = 'none';
            container.style.display = 'block';
            
            initializeCarousel();
        }

        // Analytics Functions
        function updateAnalytics(articles) {
            if (articles.length === 0) return;
            
            const sentimentCounts = {
                positive: 0,
                negative: 0,
                neutral: 0
            };
            
            articles.forEach(article => {
                const label = getSentimentLabel(article.sentiment).toLowerCase();
                sentimentCounts[label]++;
            });
            
            document.getElementById('stat-total').textContent = articles.length;
            document.getElementById('stat-positive').textContent = sentimentCounts.positive;
            document.getElementById('stat-negative').textContent = sentimentCounts.negative;
            document.getElementById('stat-neutral').textContent = sentimentCounts.neutral;
            
            updateSentimentChart(sentimentCounts);
            
            const sources = {};
            articles.forEach(article => {
                sources[article.source] = (sources[article.source] || 0) + 1;
            });
            updateSourceChart(sources);
            
            const categories = {};
            articles.forEach(article => {
                const cat = article.category || 'General';
                categories[cat] = (categories[cat] || 0) + 1;
            });
            updateCategoryChart(categories);
            
            extractTrendingTopics(articles);
            generateWordCloud(articles);
        }

        function extractTrendingTopics(articles) {
            const words = {};
            const stopWords = ['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'from', 'as', 'is', 'was', 'are', 'been', 'be', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'should', 'could', 'may', 'might', 'must', 'can', 'this', 'that', 'these', 'those'];
            
            articles.forEach(article => {
                const text = (article.title + ' ' + article.summary).toLowerCase();
                const tokens = text.match(/\b[a-z]{4,}\b/g) || [];
                
                tokens.forEach(word => {
                    if (!stopWords.includes(word)) {
                        words[word] = (words[word] || 0) + 1;
                    }
                });
            });
            
            const sortedWords = Object.entries(words)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const container = document.getElementById('trending-topics');
            container.innerHTML = '';
            
            sortedWords.forEach(([word, count]) => {
                const tag = document.createElement('a');
                tag.href = '#';
                tag.textContent = `#${word} (${count})`;
                tag.onclick = (e) => {
                    e.preventDefault();
                    document.getElementById('search-input').value = word;
                    performSearch(word);
                };
                container.appendChild(tag);
            });
        }

        function generateWordCloud(articles) {
            const words = {};
            const stopWords = ['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'from', 'as', 'is', 'was', 'are', 'been', 'be', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'should', 'could', 'may', 'might', 'must', 'can', 'this', 'that', 'these', 'those'];
            
            articles.forEach(article => {
                const text = (article.title + ' ' + article.summary).toLowerCase();
                const tokens = text.match(/\b[a-z]{4,}\b/g) || [];
                
                tokens.forEach(word => {
                    if (!stopWords.includes(word)) {
                        words[word] = (words[word] || 0) + 1;
                    }
                });
            });
            
            const sortedWords = Object.entries(words)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 20);
            
            const container = document.getElementById('analysis-word-cloud');
            container.innerHTML = '';
            
            sortedWords.forEach(([word, count], index) => {
                const wordElement = document.createElement('span');
                const size = index < 5 ? 'large' : index < 12 ? 'medium' : 'small';
                wordElement.className = `word word-${size}`;
                wordElement.textContent = word;
                wordElement.onclick = () => {
                    document.getElementById('search-input').value = word;
                    performSearch(word);
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                        if (link.dataset.page === 'for-you') {
                            link.classList.add('active');
                        }
                    });
                    document.querySelectorAll('.page-content').forEach(page => page.classList.remove('active'));
                    document.getElementById('for-you-page').classList.add('active');
                };
                container.appendChild(wordElement);
            });
        }

        // Chart Functions
        function initializeCharts() {
            const sentimentCtx = document.getElementById('sentiment-chart');
            if (sentimentCtx) {
                sentimentChart = new Chart(sentimentCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Positive', 'Negative', 'Neutral'],
                        datasets: [{
                            data: [0, 0, 0],
                            backgroundColor: ['#10b981', '#ef4444', '#64748b'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    boxWidth: 12,
                                    font: { size: 10 }
                                }
                            }
                        }
                    }
                });
            }
            
            const sourceCtx = document.getElementById('source-chart');
            if (sourceCtx) {
                sourceChart = new Chart(sourceCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: [],
                        datasets: [{
                            data: [],
                            backgroundColor: ['#4f46e5', '#7c3aed', '#ec4899', '#f59e0b', '#10b981', '#6b7280'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    boxWidth: 12,
                                    font: { size: 10 }
                                }
                            }
                        }
                    }
                });
            }
            
            const analysisSentimentCtx = document.getElementById('analysis-sentiment-chart');
            if (analysisSentimentCtx) {
                analysisSentimentChart = new Chart(analysisSentimentCtx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Positive', 'Negative', 'Neutral'],
                        datasets: [{
                            data: [0, 0, 0],
                            backgroundColor: ['#10b981', '#ef4444', '#64748b'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            const categoryCtx = document.getElementById('category-chart');
            if (categoryCtx) {
                categoryChart = new Chart(categoryCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Articles',
                            data: [],
                            backgroundColor: '#4f46e5',
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true }
                        }
                    }
                });
            }
            
            const analysisSourceCtx = document.getElementById('analysis-source-chart');
            if (analysisSourceCtx) {
                analysisSourceChart = new Chart(analysisSourceCtx.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Articles',
                            data: [],
                            backgroundColor: '#7c3aed',
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: { beginAtZero: true }
                        }
                    }
                });
            }
        }

        function updateSentimentChart(sentimentCounts) {
            const data = [sentimentCounts.positive, sentimentCounts.negative, sentimentCounts.neutral];
            
            if (sentimentChart) {
                sentimentChart.data.datasets[0].data = data;
                sentimentChart.update();
            }
            
            if (analysisSentimentChart) {
                analysisSentimentChart.data.datasets[0].data = data;
                analysisSentimentChart.update();
            }
        }

        function updateSourceChart(sources) {
            const sortedSources = Object.entries(sources)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 6);
            
            const labels = sortedSources.map(([source]) => source.substring(0, 20));
            const data = sortedSources.map(([, count]) => count);
            
            if (sourceChart) {
                sourceChart.data.labels = labels;
                sourceChart.data.datasets[0].data = data;
                sourceChart.update();
            }
            
            if (analysisSourceChart) {
                analysisSourceChart.data.labels = labels;
                analysisSourceChart.data.datasets[0].data = data;
                analysisSourceChart.update();
            }
        }

        function updateCategoryChart(categories) {
            const labels = Object.keys(categories);
            const data = Object.values(categories);
            
            if (categoryChart) {
                categoryChart.data.labels = labels;
                categoryChart.data.datasets[0].data = data;
                categoryChart.update();
            }
        }

        // Utility Functions
        function getSentimentLabel(sentiment) {
    if (sentiment > 0.1) return t('positive');
    if (sentiment < -0.1) return t('negative');
    return t('neutral');
}

        function formatTime(dateString) {
    if (!dateString) return t('recently');
    
    const date = new Date(dateString);
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 60) return `${diffMins} ${t('minutesAgo')}`;
    if (diffHours < 24) return `${diffHours} ${t('hoursAgo')}`;
    if (diffDays < 7) return `${diffDays} ${t('daysAgo')}`;
    return date.toLocaleDateString();
}

        // Event Listeners
        function setupEventListeners() {
            setupLanguageSelector();
            // Auth Modal
            document.getElementById('show-auth-btn').addEventListener('click', () => {
                document.getElementById('auth-overlay').classList.add('active');
            });

            document.getElementById('auth-close').addEventListener('click', () => {
                document.getElementById('auth-overlay').classList.remove('active');
            });

            document.getElementById('show-signup').addEventListener('click', () => {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('signup-form').style.display = 'block';
            });

            document.getElementById('show-login').addEventListener('click', () => {
                document.getElementById('signup-form').style.display = 'none';
                document.getElementById('login-form').style.display = 'block';
            });

            document.getElementById('login-form-element').addEventListener('submit', handleLogin);
            document.getElementById('signup-form-element').addEventListener('submit', handleSignup);

            // User Menu
            document.getElementById('user-avatar').addEventListener('click', () => {
                document.getElementById('user-dropdown').classList.toggle('active');
            });

            document.getElementById('logout-btn').addEventListener('click', handleLogout);

            // Close user dropdown when clicking outside
            document.addEventListener('click', (e) => {
                const userMenu = document.getElementById('user-menu');
                const userDropdown = document.getElementById('user-dropdown');
                
                if (userMenu && !userMenu.contains(e.target)) {
                    userDropdown.classList.remove('active');
                }

                const authOverlay = document.getElementById('auth-overlay');
                if (e.target === authOverlay) {
                    authOverlay.classList.remove('active');
                }
            });

            // Navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    const pageId = this.dataset.page + '-page';
                    document.querySelectorAll('.page-content').forEach(page => {
                        page.classList.remove('active');
                    });
                    document.getElementById(pageId).classList.add('active');
                    
                    if (pageId === 'trending-page') {
                        loadTrendingArticles();
                    } else if (pageId === 'for-you-page') {
                        loadNewsFromAPI();
                    } else if (pageId === 'media-literacy-page') {
                        loadMediaLiteracy();
                    } else if (pageId === 'admin-dashboard-page') {
                        loadAdminDashboard();
                    }
                });
            });
            
            // Dark mode toggle
            const modeToggle = document.getElementById('mode-toggle');
            const modeLabel = document.getElementById('mode-label');
            
            modeToggle.addEventListener('change', function() {
                document.body.classList.toggle('dark-mode', this.checked);
                modeLabel.textContent = this.checked ? 'Dark Mode' : 'Light Mode';
                localStorage.setItem('darkMode', this.checked);
            });
            
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            if (savedDarkMode) {
                modeToggle.checked = true;
                document.body.classList.add('dark-mode');
                modeLabel.textContent = 'Dark Mode';
            }
            
            // Category filters
            const categoryBtns = document.querySelectorAll('.category-btn');
            categoryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    categoryBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const category = this.dataset.category;
                    const countrySelect = document.getElementById('country-select');
                    const langSelect = document.getElementById('lang-select');
                    const country = countrySelect ? countrySelect.value : '';
                    const lang = langSelect ? langSelect.value : 'en';
                    
                    loadNewsFromAPI(category, country, lang);
                });
            });
            
            // Country filter
            const countrySelect = document.getElementById('country-select');
            if (countrySelect) {
                countrySelect.addEventListener('change', function() {
                    const categoryBtn = document.querySelector('.category-btn.active');
                    const category = categoryBtn ? categoryBtn.dataset.category : 'all';
                    const langSelect = document.getElementById('lang-select');
                    const lang = langSelect ? langSelect.value : 'en';
                    loadNewsFromAPI(category, this.value, lang);
                });
            }
            
            // Language filter
            const langSelect = document.getElementById('lang-select');
            if (langSelect) {
                langSelect.addEventListener('change', function() {
                    const categoryBtn = document.querySelector('.category-btn.active');
                    const category = categoryBtn ? categoryBtn.dataset.category : 'all';
                    const countrySelect = document.getElementById('country-select');
                    const country = countrySelect ? countrySelect.value : '';
                    loadNewsFromAPI(category, country, this.value);
                });
            }
            
            // Search functionality
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', debounce(async function() {
                const query = this.value.trim();
                
                if (query.length > 2) {
                    await performSearch(query);
                } else if (query.length === 0) {
                    const categoryBtn = document.querySelector('.category-btn.active');
                    const category = categoryBtn ? categoryBtn.dataset.category : 'all';
                    const countrySelect = document.getElementById('country-select');
                    const langSelect = document.getElementById('lang-select');
                    const country = countrySelect ? countrySelect.value : '';
                    const lang = langSelect ? langSelect.value : 'en';
                    
                    loadNewsFromAPI(category, country, lang);
                }
            }, 500));
            
            // Global click handlers
            document.addEventListener('click', async function(e) {
                // Bookmark button
                if (e.target.closest('.bookmark-btn')) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const btn = e.target.closest('.bookmark-btn');
                    const articleId = btn.dataset.articleId;
                    const article = allArticles.find(a => a.id === articleId);
                    
                    if (article) {
                        await toggleBookmark(article, btn);
                    }
                    return;
                }
                
                // Reaction buttons
                if (e.target.closest('.reaction-btn')) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const btn = e.target.closest('.reaction-btn');
                    const articleId = btn.dataset.articleId;
                    const reactionType = btn.dataset.type;
                    
                    await handleReaction(articleId, reactionType, btn);
                    return;
                }
                
                // Read more buttons
                if (e.target.classList.contains('read-more')) {
                    const url = e.target.dataset.url;
                    if (url && url !== '#') {
                        window.open(url, '_blank');
                    }
                    return;
                }
                
                // Find similar articles button
                if (e.target.classList.contains('find-similar')) {
                    const uri = e.target.dataset.uri;
                    await showSimilarArticles(uri);
                    return;
                }
                
                // Modal close
                if (e.target.classList.contains('modal-close')) {
                    document.getElementById('similar-modal').classList.remove('active');
                    return;
                }
            });
            
            // Close modal when clicking outside
            const modal = document.getElementById('similar-modal');
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        }

        async function performSearch(query) {
            const container = document.getElementById('news-container');
            const loading = document.getElementById('news-loading');
            
            loading.style.display = 'flex';
            container.style.display = 'none';
            
            const articles = await searchNews(query);
            
            loading.style.display = 'none';
            container.style.display = 'grid';
            
            await displayNewsArticles(articles, 'news-container');
            if (articles.length > 0) {
                updateAnalytics(articles);
            }
        }

        async function showSimilarArticles(articleUri) {
            const modal = document.getElementById('similar-modal');
            const loading = document.getElementById('similar-loading');
            const list = document.getElementById('similar-articles-list');
            
            modal.classList.add('active');
            loading.style.display = 'flex';
            list.innerHTML = '';
            
            const similarArticles = await findSimilarArticles(articleUri);
            
            loading.style.display = 'none';
            
            if (similarArticles.length === 0) {
                list.innerHTML = '<p class="empty-state">No similar articles found</p>';
                return;
            }
            
            similarArticles.forEach(article => {
                const sentiment = getSentimentLabel(article.sentiment);
                const sentimentEmoji = sentiment === 'Positive' ? '' : sentiment === 'Negative' ? '' : '';
                const similarityPercent = Math.round(article.similarity * 100);
                
                const item = document.createElement('div');
                item.className = 'similar-article';
                item.innerHTML = `
                    <h4 style="font-size: 16px; margin-bottom: 8px;">${article.title}</h4>
                    <p style="font-size: 14px; color: var(--gray); margin-bottom: 8px;">
                        ${article.source}  ${sentimentEmoji} ${sentiment}
                        <span class="similarity-score">${similarityPercent}% similar</span>
                    </p>
                `;
                item.onclick = () => window.open(article.url, '_blank');
                list.appendChild(item);
            });
        }

        // Carousel Functions
        function initializeCarousel() {
            const carousel = document.querySelector('.carousel');
            if (!carousel) return;
            
            const carouselItems = carousel.querySelectorAll('.carousel-item');
            if (carouselItems.length === 0) return;
            
            const prevBtn = document.querySelector('.carousel-prev');
            const nextBtn = document.querySelector('.carousel-next');
            const indicators = document.querySelectorAll('.indicator');
            
            let currentIndex = 0;
            const totalItems = carouselItems.length;
            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            let autoAdvanceInterval;
            
            function updateCarousel() {
                carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
                
                indicators.forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === currentIndex);
                });
            }
            
            function nextSlide() {
                currentIndex = (currentIndex + 1) % totalItems;
                updateCarousel();
            }
            
            function prevSlide() {
                currentIndex = (currentIndex - 1 + totalItems) % totalItems;
                updateCarousel();
            }
            
            function startAutoAdvance() {
                autoAdvanceInterval = setInterval(nextSlide, 5000);
            }
            
            function stopAutoAdvance() {
                clearInterval(autoAdvanceInterval);
            }
            
            if (prevBtn) prevBtn.addEventListener('click', () => {
                prevSlide();
                stopAutoAdvance();
                startAutoAdvance();
            });
            
            if (nextBtn) nextBtn.addEventListener('click', () => {
                nextSlide();
                stopAutoAdvance();
                startAutoAdvance();
            });
            
            carousel.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
                stopAutoAdvance();
            });
            
            carousel.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
                const diff = startX - currentX;
                
                if (Math.abs(diff) > 10) {
                    e.preventDefault();
                }
            });
            
            carousel.addEventListener('touchend', () => {
                if (!isDragging) return;
                
                const diff = startX - currentX;
                const swipeThreshold = 50;
                
                if (diff > swipeThreshold) {
                    nextSlide();
                } else if (diff < -swipeThreshold) {
                    prevSlide();
                }
                
                isDragging = false;
                startAutoAdvance();
            });
            
            carousel.addEventListener('mousedown', (e) => {
                startX = e.clientX;
                isDragging = true;
                stopAutoAdvance();
            });
            
            carousel.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                currentX = e.clientX;
            });
            
            carousel.addEventListener('mouseup', () => {
                if (!isDragging) return;
                
                const diff = startX - currentX;
                const swipeThreshold = 50;
                
                if (diff > swipeThreshold) {
                    nextSlide();
                } else if (diff < -swipeThreshold) {
                    prevSlide();
                }
                
                isDragging = false;
                startAutoAdvance();
            });
            
            carousel.addEventListener('mouseleave', () => {
                isDragging = false;
            });
            
            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => {
                    currentIndex = index;
                    updateCarousel();
                    stopAutoAdvance();
                    startAutoAdvance();
                });
            });
            
            carousel.addEventListener('mouseenter', stopAutoAdvance);
            carousel.addEventListener('mouseleave', startAutoAdvance);
            
            startAutoAdvance();
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func.apply(this, args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ========== AI FEATURES LOGIC ========== 

// AI Summary
let summaryCache = {};
let summaryTimeout;
let hideTimeout;

function initAISummaries() {
    const tooltip = document.getElementById('ai-summary-tooltip');

    document.addEventListener('mouseover', (e) => {
        const card = e.target.closest('.news-card');
        if (card && !card.classList.contains('daily-mix-card')) {
            clearTimeout(hideTimeout);
            if (tooltip.dataset.activeCardId !== card.dataset.articleId) {
                clearTimeout(summaryTimeout);
                summaryTimeout = setTimeout(() => {
                    showAISummary(card, card.dataset.articleId);
                }, 600);
            }
        }
    });

    document.addEventListener('mouseout', (e) => {
        const card = e.target.closest('.news-card');
        if (card && !card.classList.contains('daily-mix-card')) {
            clearTimeout(summaryTimeout);
            hideTimeout = setTimeout(() => {
                hideAISummary();
            }, 300);
        }
    });

    tooltip.addEventListener('mouseover', () => clearTimeout(hideTimeout));
    tooltip.addEventListener('mouseout', () => {
        hideTimeout = setTimeout(() => { hideAISummary(); }, 300);
    });
}

async function showAISummary(card, articleId) {
    const tooltip = document.getElementById('ai-summary-tooltip');
    tooltip.dataset.activeCardId = articleId;

    const cardRect = card.getBoundingClientRect();
    const tooltipWidth = 340;
    const spaceOnRight = window.innerWidth - cardRect.right;
    
    let left = cardRect.right + 15;
    if (spaceOnRight < (tooltipWidth + 20)) {
        left = cardRect.left - tooltipWidth - 15;
    }
    
    tooltip.style.top = `${cardRect.top}px`;
    tooltip.style.left = `${left}px`;

    tooltip.innerHTML = `<div class="ai-summary-header"><i class="fas fa-robot fa-spin"></i> AI Summary</div><div class="ai-summary-loading"><span>Generating...</span><div class="typing-dots"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div></div>`;
    tooltip.classList.add('active');

    try {
        if (summaryCache[articleId]) {
            tooltip.innerHTML = `<div class="ai-summary-header"><i class="fas fa-robot"></i> AI Summary</div><div class="ai-summary-content">${summaryCache[articleId]}</div>`;
            return;
        }

        const response = await fetch(`${API_BASE_URL}/ai/summary`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ articleId })
        });
        const data = await response.json();

        if (data.success) {
            summaryCache[articleId] = data.summary;
            tooltip.innerHTML = `<div class="ai-summary-header"><i class="fas fa-robot"></i> AI Summary</div><div class="ai-summary-content">${data.summary}</div>`;
        } else {
            throw new Error(data.message);
        }
    } catch (error) {
        tooltip.innerHTML = `<div class="ai-summary-header"><i class="fas fa-exclamation-circle"></i> Summary Error</div><div class="ai-summary-content">${error.message}</div>`;
    }
}

function hideAISummary() {
    const tooltip = document.getElementById('ai-summary-tooltip');
    tooltip.classList.remove('active');
    tooltip.dataset.activeCardId = null;
}

// AI Chatbot
let chatMessages = [];
let isTyping = false;

function initChatbot() {
    const chatButton = document.createElement('div');
    chatButton.className = 'ai-chat-button';
    chatButton.innerHTML = `<i class="fas fa-comments"></i><span class="pulse"></span>`;
    chatButton.onclick = openAIChat;

    const chatWindow = document.createElement('div');
    chatWindow.className = 'ai-chat-window';
    chatWindow.id = 'aiChat';
    chatWindow.innerHTML = `<div class="chat-header"><h3> NewsPulse AI</h3><button onclick="closeChat()"></button></div><div class="chat-messages" id="chatMessages"></div><div class="chat-input"><input type="text" id="chatInput" placeholder="Ask about the news..." onkeypress="if(event.key === 'Enter') sendMessage()"><button onclick="sendMessage()">Send</button></div>`;

    document.body.appendChild(chatButton);
    document.body.appendChild(chatWindow);
}

function openAIChat() {
    const chatWindow = document.getElementById('aiChat');
    chatWindow.classList.add('active');
    if (chatMessages.length === 0) {
        addMessage('bot', 'Hi!  How may I help you with the news today?');
    }
}

function closeChat() {
    document.getElementById('aiChat').classList.remove('active');
}

function addMessage(sender, text) {
    const messagesContainer = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
    messageDiv.innerHTML = `${text}<div class="message-time">${time}</div>`;
    messagesContainer.appendChild(messageDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
    if(sender === 'user') chatMessages.push({ role: 'user', content: text });
    else chatMessages.push({ role: 'assistant', content: text });
}

function showTypingIndicator() {
    const messagesContainer = document.getElementById('chatMessages');
    if(document.getElementById('typingIndicator')) return;
    const typingDiv = document.createElement('div');
    typingDiv.className = 'typing-indicator';
    typingDiv.id = 'typingIndicator';
    typingDiv.innerHTML = `<span class="dot"></span><span class="dot"></span><span class="dot"></span>`;
    messagesContainer.appendChild(typingDiv);
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function removeTypingIndicator() {
    const indicator = document.getElementById('typingIndicator');
    if (indicator) indicator.remove();
}

async function sendMessage() {
    const input = document.getElementById('chatInput');
    const message = input.value.trim();
    if (!message || isTyping) return;
    addMessage('user', message);
    input.value = '';
    isTyping = true;
    showTypingIndicator();
    
    try {
        const response = await fetch(`${API_BASE_URL}/ai/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message })
        });
        const data = await response.json();
        removeTypingIndicator();
        if (data.success) {
            addMessage('bot', data.response);
        } else {
            addMessage('bot', data.response || 'Sorry, I encountered an error.');
        }
    } catch (error) {
        removeTypingIndicator();
        addMessage('bot', 'Sorry, connection issues. Please try again.');
    }
    isTyping = false;
}
// ========== END AI FEATURES LOGIC ==========

// ========== CREDIBILITY & REVIEW SYSTEM FUNCTIONS ==========

// Star rating functionality
function initializeStarRatings() {
    const ratingContainers = document.querySelectorAll('.star-rating');
    ratingContainers.forEach(container => {
        let selectedValue = 0;
        const stars = container.querySelectorAll('.star');
        
        stars.forEach(star => {
            star.addEventListener('click', function() {
                selectedValue = parseInt(this.dataset.value);
                updateStars(container, selectedValue);
                container.dataset.rating = selectedValue;
            });
            
            star.addEventListener('mouseenter', function() {
                updateStars(container, parseInt(this.dataset.value));
            });
        });
        
        container.addEventListener('mouseleave', function() {
            updateStars(container, selectedValue);
        });
    });
}

function updateStars(container, value) {
    const stars = container.querySelectorAll('.star');
    stars.forEach((star, index) => {
        if (index < value) {
            star.classList.add('active');
        } else {
            star.classList.remove('active');
        }
    });
}

// Credibility slider
const credibilitySlider = document.getElementById('credibility-rating');
const credibilityValue = document.getElementById('credibility-value');
if (credibilitySlider && credibilityValue) {
    credibilitySlider.addEventListener('input', function() {
        credibilityValue.textContent = this.value;
    });
}

// Submit Article Modal
const submitArticleBtn = document.getElementById('submit-article-btn');
const submitArticleOverlay = document.getElementById('submit-article-overlay');
const submitArticleClose = document.getElementById('submit-article-close');
const submitArticleForm = document.getElementById('submit-article-form');

if (submitArticleBtn) {
    submitArticleBtn.addEventListener('click', () => {
        submitArticleOverlay.classList.add('active');
    });
}

if (submitArticleClose) {
    submitArticleClose.addEventListener('click', () => {
        submitArticleOverlay.classList.remove('active');
        submitArticleForm.reset();
        document.getElementById('submit-article-error').classList.remove('active');
        document.getElementById('submit-article-success').style.display = 'none';
    });
}

if (submitArticleForm) {
    submitArticleForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const errorEl = document.getElementById('submit-article-error');
        const successEl = document.getElementById('submit-article-success');
        errorEl.classList.remove('active');
        successEl.style.display = 'none';
        
        const articleData = {
            title: document.getElementById('article-title').value,
            url: document.getElementById('article-url').value,
            summary: document.getElementById('article-summary').value,
            source: document.getElementById('article-source').value,
            category: document.getElementById('article-category').value
        };
        
        try {
            const response = await fetch(`${API_BASE_URL}/credibility/submit`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(articleData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                successEl.textContent = 'Article submitted successfully! It will be reviewed by moderators.';
                successEl.style.display = 'block';
                submitArticleForm.reset();
                setTimeout(() => {
                    submitArticleOverlay.classList.remove('active');
                    successEl.style.display = 'none';
                }, 2000);
            } else {
                errorEl.textContent = data.message || 'Failed to submit article';
                errorEl.classList.add('active');
            }
        } catch (error) {
            console.error('Error submitting article:', error);
            errorEl.textContent = 'Network error. Please try again.';
            errorEl.classList.add('active');
        }
    });
}

// Review Modal
const reviewOverlay = document.getElementById('review-overlay');
const reviewClose = document.getElementById('review-close');
const reviewForm = document.getElementById('review-form');

if (reviewClose) {
    reviewClose.addEventListener('click', () => {
        reviewOverlay.classList.remove('active');
        reviewForm.reset();
        document.getElementById('review-error').classList.remove('active');
        document.getElementById('review-success').style.display = 'none';
        document.querySelectorAll('.star-rating').forEach(container => {
            container.dataset.rating = '0';
            updateStars(container, 0);
        });
    });
}

// Event delegation for Write Review buttons
document.addEventListener('click', (e) => {
    if (e.target.classList.contains('write-review') || e.target.closest('.write-review')) {
        const btn = e.target.classList.contains('write-review') ? e.target : e.target.closest('.write-review');
        const articleId = btn.dataset.articleId;
        const articleTitle = btn.dataset.articleTitle;
        
        document.getElementById('review-article-id').value = articleId;
        document.querySelector('#review-overlay .auth-header p').textContent = articleTitle;
        reviewOverlay.classList.add('active');
        initializeStarRatings();
    }
    
    if (e.target.classList.contains('view-reviews') || e.target.closest('.view-reviews')) {
        const btn = e.target.classList.contains('view-reviews') ? e.target : e.target.closest('.view-reviews');
        const articleId = btn.dataset.articleId;
        const articleTitle = btn.dataset.articleTitle;
        
        loadReviews(articleId, articleTitle);
    }
});

if (reviewForm) {
    reviewForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const errorEl = document.getElementById('review-error');
        const successEl = document.getElementById('review-success');
        errorEl.classList.remove('active');
        successEl.style.display = 'none';
        
        const overallRating = document.getElementById('overall-rating').dataset.rating || '0';
        const accuracyRating = document.getElementById('accuracy-rating').dataset.rating || '0';
        const sourcingRating = document.getElementById('sourcing-rating').dataset.rating || '0';
        const biasRating = document.getElementById('bias-rating').dataset.rating || '0';
        
        if (overallRating == 0 || accuracyRating == 0 || sourcingRating == 0 || biasRating == 0) {
            errorEl.textContent = 'Please provide all ratings';
            errorEl.classList.add('active');
            return;
        }
        
        const reviewData = {
            articleId: document.getElementById('review-article-id').value,
            overallRating: parseInt(overallRating),
            credibilityScore: parseInt(document.getElementById('credibility-rating').value),
            accuracyRating: parseInt(accuracyRating),
            sourcingRating: parseInt(sourcingRating),
            biasRating: parseInt(biasRating),
            title: document.getElementById('review-title').value,
            comment: document.getElementById('review-comment').value
        };
        
        try {
            const response = await fetch(`${API_BASE_URL}/reviews`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(reviewData)
            });
            
            const data = await response.json();
            
            if (data.success) {
                successEl.textContent = 'Review submitted successfully!';
                successEl.style.display = 'block';
                reviewForm.reset();
                document.querySelectorAll('.star-rating').forEach(container => {
                    container.dataset.rating = '0';
                    updateStars(container, 0);
                });
                setTimeout(() => {
                    reviewOverlay.classList.remove('active');
                    successEl.style.display = 'none';
                }, 2000);
            } else {
                errorEl.textContent = data.message || 'Failed to submit review';
                errorEl.classList.add('active');
            }
        } catch (error) {
            console.error('Error submitting review:', error);
            errorEl.textContent = 'Network error. Please try again.';
            errorEl.classList.add('active');
        }
    });
}

// Load Reviews
async function loadReviews(articleId, articleTitle) {
    const overlay = document.getElementById('view-reviews-overlay');
    const reviewsList = document.getElementById('reviews-list');
    document.getElementById('reviews-article-title').textContent = articleTitle;
    
    reviewsList.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
    overlay.classList.add('active');
    
    try {
        const response = await fetch(`${API_BASE_URL}/reviews/article/${articleId}`);
        const data = await response.json();
        
        if (data.success && data.reviews && data.reviews.length > 0) {
            reviewsList.innerHTML = data.reviews.map(review => `
                <div class="review-item">
                    <div class="review-header">
                        <span class="review-author">${escapeHtml(review.userId?.name || 'Anonymous')}</span>
                        <span class="review-date">${new Date(review.createdAt).toLocaleDateString()}</span>
                    </div>
                    <div style="margin: 8px 0;">
                        <strong>${escapeHtml(review.title)}</strong>
                        <div style="color: #f59e0b; font-size: 14px;">
                            ${''.repeat(review.overallRating)}${''.repeat(5 - review.overallRating)}
                        </div>
                    </div>
                    <p style="margin: 10px 0; color: var(--gray);">${escapeHtml(review.comment)}</p>
                    <div class="review-ratings">
                        <span>Credibility: ${parseInt(review.credibilityScore, 10)}/100</span>
                        <span>Accuracy: ${parseInt(review.accuracyRating, 10)}/5</span>
                        <span>Sourcing: ${parseInt(review.sourcingRating, 10)}/5</span>
                        <span>Bias: ${parseInt(review.biasRating, 10)}/5</span>
                    </div>
                    <div class="review-vote-buttons">
                        <button class="vote-btn vote-helpful" data-review-id="${escapeHtml(review._id)}">
                             Helpful (${parseInt(review.helpfulCount, 10) || 0})
                        </button>
                        <button class="vote-btn vote-not-helpful" data-review-id="${escapeHtml(review._id)}">
                             Not Helpful (${parseInt(review.notHelpfulCount, 10) || 0})
                        </button>
                    </div>
                </div>
            `).join('');
            
            // Add vote button handlers
            document.querySelectorAll('.vote-helpful, .vote-not-helpful').forEach(btn => {
                btn.addEventListener('click', async function() {
                    if (!authToken) {
                        alert('Please login to vote');
                        return;
                    }
                    
                    const reviewId = this.dataset.reviewId;
                    const isHelpful = this.classList.contains('vote-helpful');
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/reviews/${reviewId}/vote`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: JSON.stringify({ helpful: isHelpful })
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            loadReviews(articleId, articleTitle);
                        } else {
                            alert(data.message || 'Failed to vote');
                        }
                    } catch (error) {
                        console.error('Error voting:', error);
                        alert('Failed to vote. Please try again.');
                    }
                });
            });
        } else {
            reviewsList.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--gray);">No reviews yet. Be the first to review!</p>';
        }
    } catch (error) {
        console.error('Error loading reviews:', error);
        reviewsList.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--danger);">Failed to load reviews</p>';
    }
}

const viewReviewsClose = document.getElementById('view-reviews-close');
if (viewReviewsClose) {
    viewReviewsClose.addEventListener('click', () => {
        document.getElementById('view-reviews-overlay').classList.remove('active');
    });
}

// My Contributions Modal
const myContributionsBtn = document.getElementById('my-contributions-btn');
const contributionsOverlay = document.getElementById('contributions-overlay');
const contributionsClose = document.getElementById('contributions-close');

if (myContributionsBtn) {
    myContributionsBtn.addEventListener('click', () => {
        loadMyContributions();
        contributionsOverlay.classList.add('active');
    });
}

if (contributionsClose) {
    contributionsClose.addEventListener('click', () => {
        contributionsOverlay.classList.remove('active');
    });
}

async function loadMyContributions() {
    const content = document.getElementById('contributions-content');
    content.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
    
    try {
        // Load user stats
        const statsResponse = await fetch(`${API_BASE_URL}/auth/me`, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        const statsData = await statsResponse.json();
        
        if (statsData.success) {
            const reputation = statsData.user.reputation || 0;
            document.getElementById('reputation-score').textContent = reputation;
            document.getElementById('reputation-display').style.display = 'flex';
            
            content.innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>Reputation Score</h3>
                    <div class="stat-value">${reputation}</div>
                </div>
                <div style="margin-top: 20px;">
                    <h4>Your Activity</h4>
                    <p style="color: var(--gray); margin-top: 10px;">Track your contributions and earn reputation by submitting articles and writing reviews!</p>
                </div>
            `;
        }
    } catch (error) {
        console.error('Error loading contributions:', error);
        content.innerHTML = '<p style="text-align: center; color: var(--danger);">Failed to load contributions</p>';
    }
}

// AI Analysis Modal
const aiAnalysisOverlay = document.getElementById('ai-analysis-overlay');
const aiAnalysisClose = document.getElementById('ai-analysis-close');

if (aiAnalysisClose) {
    aiAnalysisClose.addEventListener('click', () => {
        aiAnalysisOverlay.classList.remove('active');
    });
}

// Event delegation for AI Check buttons
document.addEventListener('click', async (e) => {
    if (e.target.classList.contains('check-credibility') || e.target.closest('.check-credibility')) {
        const btn = e.target.classList.contains('check-credibility') ? e.target : e.target.closest('.check-credibility');
        const articleId = btn.dataset.articleId;
        
        await analyzeArticleWithAI(articleId);
    }
});

async function analyzeArticleWithAI(articleId) {
    const overlay = aiAnalysisOverlay;
    const content = document.getElementById('ai-analysis-content');
    
    overlay.classList.add('active');
    content.innerHTML = '<div class="loading"><div class="spinner"></div><p style="margin-top: 15px;">Analyzing article with AI...</p></div>';
    
    try {
        const response = await fetch(`${API_BASE_URL}/credibility/analyze/${articleId}`, {
            method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success && data.analysis) {
            const analysis = data.analysis;
            const userRatings = analysis.userRatings || { helpful: 0, notHelpful: 0 };
            const totalRatings = userRatings.helpful + userRatings.notHelpful;
            
            let scoreClass = 'low';
            if (analysis.score >= 80) scoreClass = 'high';
            else if (analysis.score >= 60) scoreClass = 'good';
            else if (analysis.score >= 40) scoreClass = 'mixed';
            
            content.innerHTML = `
                <div class="ai-analysis-box">
                    <div class="ai-score-display">
                        <div class="ai-score-number">${analysis.score}</div>
                        <div style="font-size: 18px; font-weight: 600; color: var(--dark); margin-top: 5px;">
                            Credibility Score
                        </div>
                        <div class="ai-confidence">
                            <i class="fas fa-chart-line"></i> ${analysis.confidence}% Confidence
                            ${data.cached ? '  <i class="fas fa-clock"></i> Cached' : ''}
                        </div>
                    </div>
                    
                    <div class="ai-reasoning">
                        <h4 style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-lightbulb"></i> Analysis
                        </h4>
                        <p style="line-height: 1.6;">${escapeHtml(analysis.reasoning)}</p>
                    </div>
                    
                    ${analysis.redFlags && analysis.redFlags.length > 0 ? `
                        <div class="ai-red-flags">
                            <h4 style="margin-bottom: 10px; color: #ef4444; display: flex; align-items: center; gap: 8px;">
                                <i class="fas fa-exclamation-triangle"></i> Potential Concerns
                            </h4>
                            ${analysis.redFlags.map(flag => `
                                <div class="red-flag-item">
                                    <i class="fas fa-flag"></i>
                                    <span>${escapeHtml(flag)}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="ai-rating-section">
                        <p style="width: 100%; text-align: center; margin-bottom: 10px; font-size: 14px; color: var(--gray);">
                            Was this AI analysis helpful?
                            ${totalRatings > 0 ? `<br><small>(${userRatings.helpful} helpful, ${userRatings.notHelpful} not helpful)</small>` : ''}
                        </p>
                        ${authToken ? `
                            <button class="ai-rating-btn helpful" data-article-id="${articleId}" data-helpful="true">
                                <i class="fas fa-thumbs-up"></i> Helpful
                            </button>
                            <button class="ai-rating-btn not-helpful" data-article-id="${articleId}" data-helpful="false">
                                <i class="fas fa-thumbs-down"></i> Not Helpful
                            </button>
                        ` : '<p style="font-size: 13px; color: var(--gray);">Login to rate this analysis</p>'}
                    </div>
                </div>
            `;
            
            // Add rating button handlers
            content.querySelectorAll('.ai-rating-btn').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const articleId = btn.dataset.articleId;
                    const helpful = btn.dataset.helpful === 'true';
                    
                    try {
                        const rateResponse = await fetch(`${API_BASE_URL}/credibility/analyze/${articleId}/rate`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${authToken}`
                            },
                            body: JSON.stringify({ helpful })
                        });
                        
                        const rateData = await rateResponse.json();
                        
                        if (rateData.success) {
                            // Re-analyze to show updated ratings
                            await analyzeArticleWithAI(articleId);
                        }
                    } catch (error) {
                        console.error('Error rating AI analysis:', error);
                    }
                });
            });
            
        } else {
            content.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--danger);">Failed to analyze article</p>';
        }
        
    } catch (error) {
        console.error('Error analyzing article:', error);
        content.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--danger);">Error analyzing article. Please try again.</p>';
    }
}

// Media Literacy Page
async function loadMediaLiteracy() {
    const loading = document.getElementById('media-literacy-loading');
    const content = document.getElementById('media-literacy-content');
    
    loading.style.display = 'block';
    content.innerHTML = '';
    
    try {
        const response = await fetch(`${API_BASE_URL}/media-literacy`);
        const data = await response.json();
        
        if (data.success && data.articles) {
            content.innerHTML = data.articles.map(article => {
                return `
                <div class="news-card" style="cursor: pointer;" data-slug="${escapeHtml(article.slug)}">
                    <div class="news-content">
                        <h3>${escapeHtml(article.title)}</h3>
                        <p>${escapeHtml(article.excerpt || (article.content ? article.content.substring(0, 200) + '...' : ''))}</p>
                        <div class="news-meta">
                            <span class="source">Media Literacy</span>
                            <span class="time">${new Date(article.createdAt).toLocaleDateString()}</span>
                        </div>
                    </div>
                </div>
            `;
            }).join('');
            
            // Add click handlers using event delegation
            content.querySelectorAll('.news-card').forEach(card => {
                card.addEventListener('click', function() {
                    const slug = this.dataset.slug;
                    if (slug) {
                        window.open(`${API_BASE_URL}/media-literacy/${encodeURIComponent(slug)}`, '_blank', 'noopener,noreferrer');
                    }
                });
            });
        } else {
            content.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--gray);">No media literacy articles available yet.</p>';
        }
    } catch (error) {
        console.error('Error loading media literacy:', error);
        content.innerHTML = '<p style="text-align: center; padding: 40px; color: var(--danger);">Failed to load content</p>';
    }
    
    loading.style.display = 'none';
}

// Admin Dashboard
async function loadAdminDashboard() {
    const statsContainer = document.getElementById('admin-stats');
    const loading = document.getElementById('pending-articles-loading');
    const listContainer = document.getElementById('pending-articles-list');
    
    loading.style.display = 'block';
    
    try {
        // Load stats
        const statsResponse = await fetch(`${API_BASE_URL}/admin/stats`, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        const statsData = await statsResponse.json();
        
        if (statsData.success) {
            const stats = statsData.stats;
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Articles</div>
                    <div class="stat-value">${parseInt(stats.totalArticles) || 0}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Pending Articles</div>
                    <div class="stat-value">${parseInt(stats.pendingArticles) || 0}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Reviews</div>
                    <div class="stat-value">${parseInt(stats.totalReviews) || 0}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Users</div>
                    <div class="stat-value">${parseInt(stats.totalUsers) || 0}</div>
                </div>
            `;
        }
        
        // Load pending articles
        const articlesResponse = await fetch(`${API_BASE_URL}/admin/articles/pending`, {
            headers: { 'Authorization': `Bearer ${authToken}` }
        });
        const articlesData = await articlesResponse.json();
        
        if (articlesData.success && articlesData.articles && articlesData.articles.length > 0) {
            listContainer.innerHTML = articlesData.articles.map(article => {
                const articleId = escapeHtml(article._id);
                return `
                <div class="pending-article-card" data-article-id="${articleId}">
                    <h4>${escapeHtml(article.title)}</h4>
                    <p style="color: var(--gray); margin: 8px 0;">${escapeHtml(article.summary)}</p>
                    <div style="font-size: 13px; color: var(--gray); margin: 8px 0;">
                        <strong>Source:</strong> ${escapeHtml(article.source)} | 
                        <strong>Category:</strong> ${escapeHtml(article.category)} |
                        <strong>URL:</strong> <a href="${escapeHtml(article.url)}" target="_blank" rel="noopener noreferrer" style="color: var(--primary);">View</a>
                    </div>
                    <div style="font-size: 12px; color: var(--gray);">
                        Submitted by: ${escapeHtml(article.submittedBy?.name || 'Unknown')} on ${new Date(article.submittedAt).toLocaleDateString()}
                    </div>
                    <div class="admin-actions">
                        <button class="btn-auth btn-approve" data-action="approved">Approve</button>
                        <button class="btn-auth btn-reject" data-action="rejected">Reject</button>
                    </div>
                </div>
            `;
            }).join('');
            
            // Add event listeners to buttons
            listContainer.querySelectorAll('.pending-article-card').forEach(card => {
                const articleId = card.dataset.articleId;
                card.querySelectorAll('button[data-action]').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const action = this.dataset.action;
                        reviewArticle(articleId, action);
                    });
                });
            });
        } else {
            listContainer.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--gray);">No pending articles</p>';
        }
    } catch (error) {
        console.error('Error loading admin dashboard:', error);
        listContainer.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--danger);">Failed to load dashboard</p>';
    }
    
    loading.style.display = 'none';
}

async function reviewArticle(articleId, action) {
    if (!confirm(`Are you sure you want to ${action} this article?`)) return;
    
    try {
        const response = await fetch(`${API_BASE_URL}/admin/articles/${articleId}/review`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`
            },
            body: JSON.stringify({ action })
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert(`Article ${action} successfully!`);
            loadAdminDashboard();
        } else {
            alert(data.message || `Failed to ${action} article`);
        }
    } catch (error) {
        console.error('Error reviewing article:', error);
        alert('Network error. Please try again.');
    }
}

// Update user UI on login
function updateUserUIAfterLogin() {
    const submitBtn = document.getElementById('submit-article-btn');
    if (submitBtn && authToken) {
        submitBtn.style.display = 'block';
    }
    
    // Check if user is admin/moderator
    if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'moderator')) {
        const adminNav = document.getElementById('admin-nav-link');
        if (adminNav) {
            adminNav.style.display = 'block';
        }
    }
}

// ========== END CREDIBILITY & REVIEW SYSTEM FUNCTIONS ==========
    


        // Continue with rest of JavaScript (Bookmarks, Reactions, News API, etc.)
        // Due to length limit, I'm providing the structure - the rest remains EXACTLY the same as before
        
        // [REST OF THE JAVASCRIPT CODE REMAINS EXACTLY THE SAME - Include all previous functions for:]
        // - loadUserBookmarks()
        // - toggleBookmark()
        // - handleReaction()
        // - loadUserReaction()
        // - fetchNews()
        // - searchNews()
        // - findSimilarArticles()
        // - loadNewsFromAPI()
        // - displayNewsArticles()
        // - createNewsCard()
        // - loadCarousel()
        // - initializeCarousel()
        // - updateAnalytics()
        // - initializeCharts()
        // - setupEventListeners()
        // - etc.

// [COPY ALL THE REMAINING JAVASCRIPT FROM YOUR WORKING VERSION HERE - Starting from loadUserBookmarks() onwards]
// I cannot include it here due to character limit, but keep ALL existing JavaScript functions as they were
    </script>
</body>
</html>